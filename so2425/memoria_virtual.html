<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Jesús Torres">
<title>Sistemas Operativos</title>
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */

@import url("//fonts.googleapis.com/css?family=Noto+Sans:300,600italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700");
@import url(https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css); /* Default asciidoc style framework - important */

/* CUSTOMISATIONS */
/* Change the values in root for quick customisation. If you want even more fine grain... venture further. */

:root{
--maincolor:#FFFFFF;
--primarycolor:#2c3e50;
--secondarycolor:#ba3925;
--tertiarycolor: #186d7a;
--sidebarbackground:#CCC;
--linkcolor:#b71c1c;
--linkcoloralternate:#f44336;
--white:#FFFFFF;
--black:#000000;
}

/* Text styles */
h1{color:var(--primarycolor) !important;}
h2,h3,h4,h5,h6{color:var(--secondarycolor) !important;}
.title{color:var(--tertiarycolor) !important; font-family:"Noto Sans",sans-serif !important;font-style: normal !important; font-weight: normal !important;}
p{font-family: "Noto Sans",sans-serif !important}

/* Table styles */
th{font-family: "Noto Sans",sans-serif !important}

/* Responsiveness fixes */
video {
  max-width: 100%;
}

@media all and (max-width: 600px) {
table {
  width: 55vw!important;
  font-size: 3vw;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<link rel="icon" href="media/extras/favicon.ico" sizes="any">
<link rel="icon" href="media/extras/ssoo-icon.svg" type="image/svg+xml">
<link rel="icon" type="image/png" sizes="192x192" href="media/extras/ssoo-icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="media/extras/ssoo-icon-512.png">
<link rel="apple-touch-icon" href="media/extras/ssoo-apple-touch-icon.png"><!-- 180×180 -->
<link rel="stylesheet" href="media/extras/inlineDisqussions.css">
<style>
    body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }
    content {
        flex: 1;
    }
    #preamble {
        margin-top: 0.5em;
    }
    #header, #content, #footnotes {
        margin: 0 auto 0 5em
    }
    #content h1>a.anchor, h2>a.anchor, h3>a.anchor,
    #toctitle>a.anchor, .sidebarblock>.content>.title>a.anchor,
    h4>a.anchor, h5>a.anchor, h6>a.anchor {
        color: #ba3925;
    }
    .imageblock {
        text-align: center;
    }
    .imageblock > .content {
        margin-bottom: 1rem;
    }
    .imageblock > .title {
        text-align: inherit;
    }
    .tableblock > .lightcell {
        color: gray;
    }
    table tfoot td p {
        font-weight: bold;
    }
    #footer-text {
        margin: 0 auto;
        max-width: 62.5em;
        padding-left: .9375em;
        padding-right: .9375em;
    }
    #footer-text a {
        color: hsla(0,0%,100%,.8);
        text-decoration: none;
        font-weight: bold;
    }
    #footer-text a:hover {
        color: hsla(0,0%,100%,.8);
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="media/extras/inlineDisqussions.js"></script>
<script type="text/javascript">
    window.onload = function(){
        if ('{comments_enabled}' === 'true') {
            setTimeout(function() {
                disqus_shortname = 'ull-esit-sistemas-operativos';
                jQuery("img, p, .colist td, .stemblock").not('#toc p').inlineDisqussions();
                query_params = (new URL(document.location)).searchParams;
                if (query_params.has('disqussion')) {
                    let identifier = window.location.pathname + 'disqussion-' + query_params.get('disqussion');
                    let selection = jQuery('[data-disqus-identifier="' +  identifier + '"]').not('.disqussion-link');
                    if (selection.length) {
                        selection[0].scrollIntoView(true);
                    }
                }
            }, 500);
        }
    }
</script>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
<style>
.admonitionblock td.icon .icon-time:before {content:"\f017";color:#f28500;}
</style>
</head>
<body id="memoria_virtual" class="book toc2 toc-left">
<div id="header">
<h1>Sistemas Operativos</h1>
<div class="details">
<span id="author" class="author">Jesús Torres</span><br>
<span id="email" class="email"><a href="mailto:jmtorres@ull.es">jmtorres@ull.es</a></span><br>
<span id="revdate">Curso 20XX-20XY</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Tabla de Contenido</div>
<p><span class="toc-root"><a href="main.html">Sistemas Operativos</a></span></p><ul class="sectlevel1">
<li><a href="ediciones_y_licencia.html">Ediciones y licencia</a>
</li>
<li><a href="código_de_los_ejemplos.html">Código de los ejemplos</a>
</li>
<li><a href="introducción.html">Parte I: Introducción</a>
</li>
<li><a href="organización_de_los_sistemas_operativos.html">Parte II: Organización de los sistemas operativos</a>
</li>
<li><a href="gestión_de_procesos.html">Parte III: Gestión de procesos</a>
</li>
<li><a href="gestión_de_la_memoria.html">Parte IV: Gestión de la memoria</a>
<ul class="sectlevel1">
<li><a href="memoria_principal.html">15. Memoria principal</a>
</li>
<li><a href="paginación.html">16. Paginación</a>
</li>
<li><a href="memoria_virtual.html"><span class="toc-current">17. Memoria virtual</span></a>
<ul class="sectlevel2">
<li><a href="memoria_virtual.html#_paginación_bajo_demanda">17.1. Paginación bajo demanda</a>
</li>
<li><a href="memoria_virtual.html#_copy_on_write">17.2. Copy-on-write</a>
</li>
<li><a href="memoria_virtual.html#_archivos_mapeados_en_memoria">17.3. Archivos mapeados en memoria</a>
</li>
<li><a href="memoria_virtual.html#_reemplazo_de_página">17.4. Reemplazo de página</a>
</li>
<li><a href="memoria_virtual.html#_asignación_de_marcos_de_página">17.5. Asignación de marcos de página</a>
</li>
<li><a href="memoria_virtual.html#_hiperpaginación">17.6. Hiperpaginación</a>
</li>
<li><a href="memoria_virtual.html#_otras_consideraciones">17.7. Otras consideraciones</a>
</li>
<li><a href="memoria_virtual.html#_interfaz_de_gestión_de_la_memoria">17.8. Interfaz de gestión de la memoria</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="gestión_del_almacenamiento.html">Parte V: Gestión del almacenamiento</a>
</li>
<li><a href="bibliografía.html">Bibliografía</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="memoria_virtual"><a class="anchor" href="#memoria_virtual"></a>17. Memoria virtual</h2>
<div class="sectionbody">
<div class="admonitionblock time">
<table>
<tr>
<td class="icon">
<i class="fa icon-time" title=""></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Tiempo de lectura:</strong> 1 hora y 8 minutos</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La <strong>memoria virtual</strong> es una técnica que permite la ejecución de procesos sin que estos tengan que ser cargados completamente en la memoria.</p>
</div>
<div class="paragraph">
<p>Los programas suelen tener partes de código que rara vez son ejecutadas.
Por ejemplo, las funciones para manejar condiciones de error que, aunque útiles, generalmente nunca son invocadas.
También es frecuente que se reserve más memoria para datos de lo que realmente es necesario.
Por ejemplo, muchos programadores tienen la costumbre de hacer cosas tales como declarar un <em>array</em> de 65536 elementos, cuando realmente solo necesitan 255.
Teniendo todo esto en cuenta, y con el fin de mejorar el aprovechamiento de la memoria, parece que sería interesante no tener que cargar todas las porciones de los procesos y que, aún así, pudieran ejecutarse.
Eso es exactamente lo que proporciona la <strong>memoria virtual</strong>.</p>
</div>
<div class="paragraph">
<p>La habilidad de ejecutar un proceso cargado parcialmente en memoria proporciona algunos beneficios importantes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un programa nunca más estaría limitado por la cantidad de memoria disponible.</p>
<div class="paragraph">
<p>Es decir, los desarrolladores pueden escribir programas considerando que disponen de un espacio de direcciones virtual extremadamente grande, sin considerar la cantidad de memoria realmente disponible.
No debemos olvidar que sin memoria virtual, para que un proceso pueda ser ejecutado, debe estar completamente cargado en la memoria.</p>
</div>
</li>
<li>
<p>Puesto que cada programa ocupa menos memoria, más programas se pueden ejecutar al mismo tiempo; con el correspondiente incremento en el uso de la CPU y en el rendimiento del sistema, pero sin efectos negativos en el tiempo de respuesta y en el de ejecución.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El concepto de <strong>memoria virtual</strong> no debe confundirse con el de <strong>espacio de direcciones virtual</strong>.
Sin embargo están relacionados, puesto que el que exista separación entre la memoria física y la manera en la que los procesos perciben la memoria es un requisito para poder implementar la memoria virtual.</p>
</div>
<div class="sect2">
<h3 id="_paginación_bajo_demanda"><a class="anchor" href="#_paginación_bajo_demanda"></a>17.1. Paginación bajo demanda</h3>
<div class="paragraph">
<p>La <strong>paginación bajo demanda</strong> es la técnica con la que frecuentemente se implementa la <strong>memoria virtual</strong> en los sistemas con paginación.</p>
</div>
<div class="paragraph">
<p>En la <strong>paginación bajo demanda</strong> las páginas individuales, en las que se dividen los espacios de direcciones virtuales de los diferentes procesos, pueden ser sacadas de la memoria de manera temporal y copiadas a un almacenamiento de respaldo, para posteriormente volver a ser traídas a la memoria cuando son necesitadas por su proceso.
A este proceso de guardado y recuperación de las páginas sobre el almacenamiento de respaldo se lo denomina <strong>intercambio</strong> o <strong><em>swapping</em></strong> y es llevado a cabo por un componente del sistema operativo denominado el <strong>paginador</strong>.</p>
</div>
<div class="paragraph">
<p>Para que se puedan cargar las páginas cuando son necesitadas por su proceso, hace falta que el <strong>paginador</strong> sepa cuándo lo son.
Eso requiere que el hardware proporcione algún tipo de soporte, por ejemplo, incorporando un <strong>bit de válido</strong> a la entrada de cada página en la tabla de páginas, que se utiliza de la siguiente manera:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cuando el <strong>bit de válido</strong> está a 1 la página es legal y está en la memoria.
Es decir, la página existe en el espacio de direcciones virtual del proceso y tiene asignado un marco de memoria física.</p>
</li>
<li>
<p>Cuando el <strong>bit de válido</strong> está a 0, pueden ocurrir varias cosas:</p>
<div class="ulist">
<ul>
<li>
<p>La página es legal, pero está almacenada en disco y no en la memoria.</p>
</li>
<li>
<p>La página no es legal.
Es decir, no existe en el espacio de direcciones virtual del proceso.</p>
<div class="paragraph">
<p>Esto puede ser debido a que la página esté en un hueco del espacio de direcciones —en una región que no está siendo utilizada— por lo que el sistema operativo no le ha asignado espacio de almacenamiento ni en disco ni en la memoria.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Si un proceso accede a una página legal, no ocurre nada y la instrucción se ejecuta con normalidad.
Pero si accede a una página marcada como inválida:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Al intentar acceder a la página, la MMU comprueba el bit de válido y genera una excepción de <strong>fallo de página</strong> al estar marcada como inválida.
Dicha excepción es capturada por el sistema operativo.</p>
</li>
<li>
<p>El sistema operativo comprueba en una tabla interna si la página es legal o no.
Es decir, si la página realmente no pertenece al espacio de direcciones virtual del proceso o si pertenece, pero está almacenada en el disco.
Esta tabla interna suele almacenarse en el PCB del proceso como parte de la información de gestión de la memoria.</p>
</li>
<li>
<p>Si la página es ilegal, el proceso ha cometido un error y debe ser terminado.
En sistemas POSIX, por ejemplo, el sistema envía al proceso una señal de <strong>violación de segmento</strong> que lo obliga a terminar.</p>
</li>
<li>
<p>Si la página es legal, se carga desde el disco:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>El núcleo busca un marco de memoria libre que, por ejemplo, se puede escoger de la lista de marcos libres del sistema.</p>
</li>
<li>
<p>Se solicita una operación de disco para leer la página deseada en el marco asignado.</p>
<div class="paragraph">
<p>Puesto que no resulta eficiente mantener la CPU ocupada mientras la página es recuperada desde el disco, el sistema debe solicitar la lectura de la página y poner al proceso en estado <strong>esperando</strong>.</p>
</div>
</li>
<li>
<p>Cuando la lectura del disco haya terminado, se modifica la tabla interna, antes mencionada, y la tabla de páginas para indicar que la página está en la memoria.</p>
</li>
<li>
<p>Reiniciar la instrucción que fue interrumpida por la excepción.
Generalmente esto se hace colocando el proceso nuevamente en la <strong>cola de preparados</strong> y dejando que el <strong>asignador</strong> lo reinicie cuando sea escogido por el <strong>planificador</strong> de la CPU.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Un caso extremo de la paginación bajo demanda es la <strong>paginación bajo demanda pura</strong>.
En ella la ejecución de un proceso se inicia sin cargar ninguna página en la memoria.
Cuando el sistema operativo sitúa el contador de programa en la primera instrucción del proceso —que es una página no residente en memoria— se genera inmediatamente un <strong>fallo de página</strong>.
La página es cargada en la memoria —tal y como hemos descrito anteriormente— y el proceso continúa ejecutándose, fallando cuando sea necesario con cada página que necesite y no esté cargada.
Las principales ventajas de la <strong>paginación bajo demanda pura</strong> son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nunca se trae desde el disco una página que no sea necesaria.</p>
</li>
<li>
<p>El inicio de la ejecución de un proceso es mucho más rápido que si se cargara todo el proceso desde el principio.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_requerimientos_de_la_paginación_bajo_demanda"><a class="anchor" href="#_requerimientos_de_la_paginación_bajo_demanda"></a>17.1.1. Requerimientos de la paginación bajo demanda</h4>
<div class="paragraph">
<p>Los requerimientos hardware para que un sistema operativo pueda soportar la <strong>paginación bajo demanda</strong> son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tabla de páginas con habilidad para marcar entradas inválidas, ya sea utilizando un bit específico o con valores especiales en los bits de protección.</p>
</li>
<li>
<p>Disponibilidad de un dispositivo de almacenamiento secundario.</p>
<div class="paragraph">
<p>En este dispositivo se guardan las páginas que no están presentes en la memoria principal.
Normalmente se trata de un disco conocido como <strong>dispositivo de intercambio</strong>, mientras que la sección de disco utilizada concretamente para dicho propósito se conoce como <strong>espacio de intercambio</strong> o <strong><em>swap</em></strong>.</p>
</div>
</li>
<li>
<p>Posibilidad de reiniciar cualquier instrucción después de un fallo de página.</p>
<div class="paragraph">
<p>En la mayor parte de los casos esta funcionalidad es sencilla de conseguir.
Sin embargo, la mayor dificultad proviene de las instrucciones que pueden modificar diferentes posiciones de la memoria, como aquellas pensadas para mover bloques de bytes o palabras.
En el caso de que el bloque de origen o de destino atraviese un borde de página, la instrucción sería interrumpida cuando la operación solo haya sido realizada parcialmente.
Si además ambos bloques se superpusieran, no se podría reiniciar la instrucción completa.
Las posibles soluciones a este problema deben ser implementadas en la CPU.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_rendimiento_de_la_paginación_bajo_demanda"><a class="anchor" href="#_rendimiento_de_la_paginación_bajo_demanda"></a>17.1.2. Rendimiento de la paginación bajo demanda</h4>
<div class="paragraph">
<p>Indudablemente, el rendimiento de un sistema con <strong>paginación bajo demanda</strong> se ve afectado por el <strong>número de fallos de páginas</strong>.
En el peor de los casos, en cada instrucción un proceso puede intentar acceder a una página distinta, empeorando notablemente el rendimiento.
Sin embargo, esto no ocurre, puesto que los programas tienden a tener localidad de referencia (véase el <a href="memoria_virtual.html#_hiperpaginación">Apartado 17.6</a>).</p>
</div>
<div class="sect4">
<h5 id="_tiempos_de_acceso_efectivo"><a class="anchor" href="#_tiempos_de_acceso_efectivo"></a>Tiempos de acceso efectivo</h5>
<div class="paragraph">
<p>Como con la <strong>paginación</strong>, el rendimiento de un sistema con <strong>paginación bajo demanda</strong> también está relacionado con el concepto de <strong>tiempo de acceso efectivo</strong> a la memoria, que intenta estimar el tiempo que realmente se tarda en acceder a la memoria teniendo en cuenta mecanismos del sistema operativo.</p>
</div>
<div class="paragraph">
<p>Supongamos que conocemos la probabilidad \$p_text(fp)\$ de que ocurra un fallo de página.
El <strong>tiempo de acceso efectivo</strong> se podría calcular como la probabilidad de que no ocurra un fallo de página \$(1 - p_text(fp))\$ por el <strong>tiempo de acceso</strong> a la memoria \$T_text(m)\$, más la probabilidad de que ocurra un fallo de página \$p_text(fp))\$ por el tiempo necesario para gestionar cada fallo de página —o <strong>tiempo de fallo de página</strong>— \$T_text(fp)\$:</p>
</div>
<div id="eq_tiempo_bajo_demanda" class="stemblock">
<div class="content">
\[\begin{equation}
T_\mathrm{em}=(1-p_{fp}) T_\mathrm{m} + p_\mathrm{fp} T_\mathrm{fp}
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>Por tanto, para calcular el <strong>tiempo de acceso efectivo</strong> \$T_text(em)\$ necesitamos estimar el <strong>tiempo de fallo de página</strong> \$T_text(fp)\$, que se consume fundamentalmente en:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Servir la excepción de fallo de página.</p>
<div class="paragraph">
<p>Esto incluye capturar la interrupción, salvar los registros y el estado del proceso, determinar que la interrupción es debida a una excepción de <strong>fallo de página</strong>, comprobar si la página es legal y determinar la localización de la misma en el disco.
Aproximadamente, en realizar esta tarea el sistema puede tardar de 1 a 100 μs.</p>
</div>
</li>
<li>
<p>Leer la página en un marco libre.
En esta tarea se puede tardar alrededor de 8 ms, pero este tiempo puede ser mucho mayor si el dispositivo está ocupado y se debe esperar a que se realicen otras operaciones.</p>
</li>
<li>
<p>Reiniciar el proceso.
Si incluimos el tiempo de espera en la cola de preparados, se puede tardar entre 1 y 100 μs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Como se puede apreciar, la mayor parte del <strong>tiempo de fallo de página</strong> es debido al tiempo requerido para acceder al <strong>dispositivo de intercambio</strong>.</p>
</div>
<div class="paragraph">
<p>Para ilustrar el cálculo del <strong>tiempo de acceso efectivo</strong> a la memoria, solo vamos a considerar el tiempo requerido para acceder al <strong>dispositivo de intercambio</strong>, ignorando las otras tareas a realizar durante el <strong>fallo de página</strong>, ya que comparativamente consumen mucho menos tiempo.
Vamos a suponer que el <strong>tiempo de acceso</strong> a la memoria \$T_text(m)\$ es de 200 ns y que la probabilidad \$p_text(fp)\$ es muy pequeña —es decir, \(p_\mathrm{fp} \ll 1\)—:</p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{split}
T_\mathrm{em} &amp;= (1-p_\mathrm{fp}) \cdot 200\,\text{ns}+p_\mathrm{fp} \cdot 8\,\text{ms.} \\
       &amp;= (1-p_\mathrm{fp}) \cdot 200\,\text{ns}+p_\mathrm{fp} \cdot 8\,000\,000\,\text{ms.} \\
       &amp;\approx 200\,\text{ns} + 7\,999\,800\,\text{ms.} \cdot p_\mathrm{fp}
\end{split}\]
</div>
</div>
<div class="paragraph">
<p>Como se puede apreciar el <strong>tiempo de acceso efectivo</strong> es proporcional a la <strong>tasa de fallos de página</strong> \$tau_text(fp)\$:</p>
</div>
<div id="eq_tiempo_bajo_demanda_simplificada" class="stemblock">
<div class="content">
\[\begin{equation}
T_\mathrm{em} \approx T_\mathrm{m} + \tau_\mathrm{fp}
\end{equation}\]
</div>
</div>
<div class="paragraph">
<p>donde:</p>
</div>
<div class="stemblock">
<div class="content">
\$tau_text(fp)=p_text(fp) T_text(fp)\$
</div>
</div>
<div class="paragraph">
<p>Por ejemplo, si un proceso causa un fallo de página en uno de cada 1000 accesos —es decir, \$p_text(fp)= 0.001\$ — el <strong>tiempo de acceso efectivo</strong> es de 8.2 ms, por lo que el rendimiento del sistema es 40 veces inferior debido a la <strong>paginación bajo demanda</strong>.
Por tanto, es necesario mantener la <strong>tasa de fallos de página</strong> \$tau_text(fp)\$ lo más baja posible para mantener un rendimiento adecuado.</p>
</div>
<div class="paragraph">
<p>Hemos venido considerado \$T_text(m)\$ como el tiempo de acceso a la memoria física por simplicidad.
Sin embargo, realmente estamos en un sistema que utiliza paginación —incluso con varios niveles— y que puede usar una TLB para mejorar su rendimiento.
Entonces, si queremos ser más precisos, podemos considerar \$T_text(m)\$ como el <strong>tiempo de acceso efectivo</strong> que calculamos en el <a href="paginación.html">Capítulo 16</a>.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, en el <a href="paginación.html#_tiempos_de_acceso_a_la_memoria">Apartado 16.3</a> vimos que el <strong>tiempo de acceso efectivo</strong> para el <strong>método básico de paginación</strong> con <strong>TLB</strong> era:</p>
</div>
<div class="stemblock">
<div class="content">
\[T_\mathrm{em} = (2-p_\mathrm{TLB})T_\mathrm{m} + T_\mathrm{TLB}\]
</div>
</div>
<div class="paragraph">
<p>donde \$p_text(TLB)\$ es la probabilidad de que una entrada esté en la <strong>TLB</strong> y \$T_text(m)\$ es el <strong>tiempo de acceso</strong> a la memoria física.
Si sustitumos esta expresión por el \$T_text(m)\$ de la <a href="memoria_virtual.html#eq_tiempo_bajo_demanda_simplificada">(2)</a>, obtenemos:</p>
</div>
<div class="stemblock">
<div class="content">
\[T_\mathrm{em} \approx (2-p_\mathrm{TLB})T_\mathrm{m} + T_\mathrm{TLB} + \tau_\mathrm{fp}\]
</div>
</div>
<div class="paragraph">
<p>que nos daría el <strong>tiempo de acceso efectivo</strong> a la memoria en <strong>paginación bajo demanda</strong> con una <strong>tabla de páginas lineal</strong> y <strong>TLB</strong>.</p>
</div>
<div class="paragraph">
<p>Mientras que si sustituimos el <strong>tiempo de acceso efectivo</strong> calculado en el <a href="paginación.html#_tiempos_de_acceso_a_la_memoria_2">Apartado 16.6.3</a>:</p>
</div>
<div class="stemblock">
<div class="content">
\[T_\mathrm{em} = ((1-p_\mathrm{TLB})n+1)T_\mathrm{m} + T_\mathrm{TLB}\]
</div>
</div>
<div class="paragraph">
<p>obtenemos el <strong>tiempo de acceso efectivo</strong> a la memoria en <strong>paginación bajo demanda</strong> con <strong>paginación jerárquica</strong> de <em>n</em> niveles:</p>
</div>
<div class="stemblock">
<div class="content">
\[T_\mathrm{em} \approx ((1-p_\mathrm{TLB})n+1)T_\mathrm{m} + T_\mathrm{TLB} + \tau_\mathrm{fp}\]
</div>
</div>
<div class="paragraph">
<p>Sin embargo, debemos recordar que para obtener ambas expresiones estamos simplificando bajo la suposición de que \(p_\mathrm{fp} \ll 1\).
Si no podemos hacer esta suposición, podemos volver a la <a href="memoria_virtual.html#eq_tiempo_bajo_demanda">(1)</a> original y repetir la sustitución de \$T_text(m)\$ por las expresiones para \$T_text(em)\$ en cada caso.</p>
</div>
<div class="paragraph">
<p>Así obtenemos que el <strong>tiempo de acceso efectivo</strong> \$T_text(em)\$ para <strong>tabla de páginas lineal</strong> con <strong>TLB</strong> y <strong>paginación bajo demanda</strong> es:</p>
</div>
<div class="stemblock">
<div class="content">
\[T_\mathrm{em} = (1-p_\mathrm{fp}) \left[(2-p_\mathrm{TLB})T_\mathrm{m} + T_\mathrm{TLB}\right] + \tau_\mathrm{fp}\]
</div>
</div>
<div class="paragraph">
<p>Mientras que para la <strong>paginación jerárquica</strong> de <em>n</em> niveles es:</p>
</div>
<div class="stemblock">
<div class="content">
\[T_\mathrm{em} = (1-p_\mathrm{fp}) \left[((1-p_\mathrm{TLB})n+1)T_\mathrm{m} + T_\mathrm{TLB}\right] + \tau_\mathrm{fp}\]
</div>
</div>
</div>
<div class="sect4">
<h5 id="_manejo_y_uso_del_espacio_de_intercambio"><a class="anchor" href="#_manejo_y_uso_del_espacio_de_intercambio"></a>Manejo y uso del espacio de intercambio</h5>
<div class="paragraph">
<p>Otro aspecto fundamental que afecta al rendimiento de la <strong>paginación bajo demanda</strong> es el uso del espacio de intercambio.</p>
</div>
<div class="paragraph">
<p>Cuando un proceso genera un <strong>fallo de página</strong>, el sistema operativo debe recuperar la página de allí donde esté almacenada.
Si esto ocurre al principio de la ejecución, ese lugar seguramente será el archivo que contiene la imagen binaria del programa, pues es donde se encuentran las páginas en su estado inicial.
Sin embargo, el acceso al espacio de intercambio es mucho más eficiente que el acceso a un sistema de archivos, incluso aunque el primero esté almacenado dentro de un archivo de gran tamaño.
Esto es debido a que los datos se organizan en bloques contiguos de gran tamaño, se evitan las búsquedas de archivos y las indirecciones en la asignación de espacio.
Por ello debemos plantearnos qué hacer con las imágenes de los programas que van a ser ejecutados.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se puede mejorar el rendimiento copiando en el espacio de intercambio la imagen completa de los programas durante el inicio del proceso, para después realizar la <strong>paginación bajo demanda</strong> sobre dicha copia.</p>
</li>
<li>
<p>Otra alternativa es cargar las páginas desde el archivo que contiene la imagen cuando son usadas por primera vez, pero siendo escritas en el espacio de intercambio cuando dichas páginas tienen que ser reemplazadas.
Esta aproximación garantiza que solo las páginas necesarias son leídas desde el sistema de archivos, reduciendo el uso de espacio de intercambio, mientras que las siguientes operaciones de intercambio se hacen sobre dicho espacio.</p>
</li>
<li>
<p>También se puede suponer que el código de los procesos no puede cambiar.
Esto permite utilizar el archivo de la imagen binaria para recargar las páginas de código, lo que también evita escribirlas cuando son sustituidas.
Sin embargo, el espacio de intercambio se sigue utilizando para las páginas que no están directamente asociadas a un archivo, como la pila o el montón de los procesos.</p>
<div class="paragraph">
<p>Este último método parece conseguir un buen compromiso entre el tamaño del espacio de intercambio y el rendimiento.
Por eso se utiliza en la mayor parte de los sistemas operativos modernos.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_copy_on_write"><a class="anchor" href="#_copy_on_write"></a>17.2. Copy-on-write</h3>
<div class="paragraph">
<p>
El <strong><em>copy-on-write</em></strong> o <strong>copia durante la escritura</strong> permite la creación rápida de nuevos procesos, minimizando la cantidad de páginas que deben ser asignadas a estos.</p>
</div>
<div class="paragraph">
<p>Para entenderlo, es importante recordar que la llamada al sistema <a href="https://man7.org/linux/man-pages/man2/fork.2.html">fork()</a> crea un proceso hijo cuyo espacio de direcciones es un duplicado del espacio de direcciones del padre.
Indudablemente, esto significa que durante la llamada es necesario asignar suficientes marcos de memoria física como para alojar las páginas del nuevo proceso hijo.
El <strong><em>copy-on-write</em></strong> minimiza de la siguiente manera el número de marcos que deben ser asignadas al nuevo proceso:</p>
</div>
<div id="fig-copy-on-write-1" class="imageblock">
<div class="content">
<img src="media/C17-memoria_virtual/copy_on_write1.svg" alt="copy on write1">
</div>
<div class="title">Figura 17.1. Copy-on-write antes de que el proceso 1 modifique la página A.</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Cuando la llamada al sistema <a href="https://man7.org/linux/man-pages/man2/fork.2.html">fork()</a> crea el nuevo proceso lo hace de forma que este comparta todas sus páginas con las del padre (véase la <a href="memoria_virtual.html#fig-copy-on-write-1">Figura 17.1</a>).</p>
<div class="paragraph">
<p>Sin el <strong><em>copy-on-write</em></strong> el <a href="https://man7.org/linux/man-pages/man2/fork.2.html">fork()</a> tendría que asignar marcos de memoria física al hijo, para a continuación copiar las páginas del padre en ellos.
Sin embargo, con el <strong><em>copy-on-write</em></strong> padre e hijo mapean sus páginas en los mismos marcos, evitando tener que asignar memoria libre.</p>
</div>
</li>
<li>
<p>Las páginas compartidas se marcan como <strong><em>copy-on-write</em></strong>.</p>
<div class="paragraph">
<p>Para ello se pueden marcar todas las páginas como de <strong>solo lectura</strong> en la tabla de páginas de ambos procesos y utilizar una tabla interna alojada en el PCB para indicar cuáles son realmente de solo lectura y cuáles están en <strong><em>copy-on-write</em></strong>.
Es importante destacar que realmente solo las páginas que pueden ser modificadas se marcan como <strong><em>copy-on-write</em></strong>. Las páginas que no pueden ser modificadas —por ejemplo, las que contienen el código ejecutable del programa— simplemente pueden ser compartidas como de solo lectura por los procesos, como hemos comentado anteriormente.</p>
</div>
</li>
<li>
<p>Si algún proceso intenta escribir en una página <strong><em>copy-on-write</em></strong>, la MMU genera una excepción para notificar el suceso al sistema operativo.
Siguiendo lo indicado en el punto anterior, la excepción se originaría porque la página está marcada como de solo lectura, por lo que el sistema operativo comprobará si se trata de un acceso a una página <strong><em>copy-on-write</em></strong> o a un intento real de escribir en una página de solo lectura.
Para ello, el sistema solo tiene que mirar la tabla interna almacenada en el PCB.
Si se ha intentado escribir en una página de solo lectura, el proceso ha cometido un error y generalmente será terminado.</p>
</li>
</ol>
</div>
<div id="fig-copy-on-write-2" class="imageblock">
<div class="content">
<img src="media/C17-memoria_virtual/copy_on_write2.svg" alt="copy on write2">
</div>
<div class="title">Figura 17.2. Copy-on-write después de que el proceso 1 modifique la página A.</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Si el sistema detecta una escritura a una página de <strong><em>copy-on-write</em></strong> solo tiene que copiarla en un marco libre y mapearlo en el espacio de direcciones del proceso (véase la <a href="memoria_virtual.html#fig-copy-on-write-2">Figura 17.2</a>).</p>
<div class="paragraph">
<p>Para esto se sustituye la página compartida por otra que contiene una copia, pero que ya no está compartida.
Obviamente, la nueva página debe ser marcada como de escritura para que en el futuro pueda ser modificada por el proceso.</p>
</div>
</li>
<li>
<p>La página original marcada como <strong><em>copy-on-write</em></strong> puede ser marcada como de escritura y no como <strong><em>copy-on-write</em></strong>, pero solo si no va a seguir siendo compartida.
Esto es así porque una página marcada como <strong><em>copy-on-write</em></strong> puede estar siendo compartida con otros procesos.</p>
</li>
<li>
<p>El sistema operativo puede reiniciar el proceso.
A partir de ahora, este puede escribir en la página sin afectar al resto de los procesos.
Sin embargo, puede seguir compartiendo otras páginas en <strong><em>copy-on-write</em></strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>El <strong><em>copy-on-write</em></strong> permite ahorrar memoria y tiempo en la creación de los procesos, puesto que solo se copian las páginas que son modificadas por estos.
Por eso se trata de una técnica común en múltiples sistemas operativos, como por ejemplo los sistemas POSIX modernos y Microsoft Windows.</p>
</div>
<div class="paragraph">
<p>El <strong><em>copy-on-write</em></strong> es especialmente interesante si a continuación se va a utilizar la llamada al sistema <a href="https://man7.org/linux/man-pages/man3/exec.3.html">exec()</a> puesto que si es así, copiar el espacio de direcciones completo es una pérdida de tiempo.</p>
</div>
<div class="paragraph">
<p>El <strong><em>copy-on-write</em></strong> también permite a los sistemas modernos ahorrar memoria durante la reserva de grandes cantidades de memoria.
Cuando un proceso pide reservar páginas de memoria, generalmente los sistemas deben proporcionar páginas con marcos sobreescritos con ceros, para evitar exponer los datos del proceso que los utilizó anteriormente.
En previsión de esto, el sistema mantiene un marco completamente a 0 y durante las reservas de memoria proporciona páginas en <strong><em>copy-on-write</em></strong> sobre dicho marco a 0.
De esta forma, se ahorra memoria física y tiempo de CPU, puesto que realmente no se asigna un marco de memoria física y se pone a 0 su contenido hasta el momento en el que el proceso intenta escribir en una página de memoria previamente reservada.</p>
</div>
</div>
<div class="sect2">
<h3 id="_archivos_mapeados_en_memoria"><a class="anchor" href="#_archivos_mapeados_en_memoria"></a>17.3. Archivos mapeados en memoria</h3>
<div class="paragraph">
<p>
Los <strong>archivos mapeados en memoria</strong> permiten acceder a un archivo como parte del espacio de direcciones virtuales de un proceso.
Algunas de las características de esta técnica son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cuando una región del espacio de direcciones queda marcada para ser mapeada sobre una región de un archivo, se utiliza una estrategia similar a la comentada para el método básico de la paginación bajo demanda.
La diferencia es que las páginas son cargadas desde dicho archivo y no desde el espacio de intercambio.
Es decir, en un primer acceso a una página mapeada se produce un <strong>fallo de página</strong> que es resuelto por el sistema operativo leyendo una porción del archivo en el marco asignado a la página.</p>
</li>
<li>
<p>Esto significa que la lectura y escritura del archivo se realiza a través de lecturas y escrituras en la memoria, lo que simplifica el acceso y elimina el costo adicional de las llamadas al sistema: <a href="https://man7.org/linux/man-pages/man2/read.2.html">read()</a>, <a href="https://man7.org/linux/man-pages/man2/write.2.html">write()</a>, etc.</p>
</li>
<li>
<p>Las escrituras en disco se suelen realizar de forma asíncrona.
Es decir, los datos no se escriben inmediatamente en disco cuando se modifica la página, sino que el sistema operativo comprueba periódicamente las páginas modificadas y las escribe en disco.</p>
</li>
<li>
<p>Los marcos utilizados en el mapeo pueden ser compartidos, lo que permite compartir los datos de los archivos.
Además, se puede incluir soporte de <strong><em>copy-on-write</em></strong>, lo que permite a los procesos compartir buena parte de un archivo en modo de solo lectura, pero disponiendo de sus propias copias de aquellas páginas que modifiquen.</p>
<div class="paragraph">
<p>Indudablemente, para que los procesos puedan compartir datos es necesario que exista algún tipo de coordinación (véase el <a href="sincronización.html">Capítulo 13</a>).</p>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ejemplo_de_mapeo_de_archivos"><a class="anchor" href="#_ejemplo_de_mapeo_de_archivos"></a>17.3.1. Ejemplo de mapeo de archivos</h4>
<div class="paragraph">
<p>Tanto en los sistemas POSIX como en Windows API el archivo a mapear hay que abrirlo con la llamada al sistema destinada a ello.
Por ejemplo, en sistemas POSIX:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="cpp"><span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span> <span class="s">"foo.txt"</span><span class="p">,</span> <span class="n">O_RDONLY</span> <span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En la API POSIX con esto es suficiente para usar la llamada al sistema <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a> y mapear el archivo en memoria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c"><span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">lseek</span><span class="p">(</span> <span class="n">fd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SEEK_END</span> <span class="p">);</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="kt">void</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mmap</span><span class="p">(</span>
    <span class="nb">NULL</span><span class="p">,</span>
    <span class="n">length</span><span class="p">,</span>                 <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="n">PROT_READ</span><span class="p">,</span>              <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="n">MAP_SHARED</span><span class="p">,</span>
    <span class="n">fd</span><span class="p">,</span>                     <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="mi">0</span>                       <i class="conum" data-value="3"></i><b>(3)</b>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Descriptor del archivo abierto con <a href="https://man7.org/linux/man-pages/man2/open.2.html">open()</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>La longitud de la región del archivo a mapear.
Si queremos mapear todo el archivo, podemos usar <a href="https://www.man7.org/linux/man-pages/man2/lseek.2.html">lseek()</a> para conocer su longitud.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Si no se mapea todo el archivo, se puede indicar la posición del archivo donde comenzar el mapeo.
Esta posición debe ser múltiplo del tamaño de página.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Permisos de la memoria mapeada.
Deben coincidir con el modo con el que se abrió el archivo.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez mapeado el archivo, si no se van a crear más mapeos, se puede cerrar el descriptor de archivo con <a href="https://man7.org/linux/man-pages/man2/close.2.html">close()</a>.
Y la región de memoria mapeada se puede liberar, al terminar, con <a href="https://man7.org/linux/man-pages/man2/munmap.2.html">munmap()</a>.</p>
</div>
<div class="paragraph">
<p>En <a href="https://github.com/ull-esit-sistemas-operativos/ssoo-ejemplos/blob/master/src/cap17/mapped-files.c">mapped-files.c</a> se puede ver un ejemplo de un programa que cuenta el número de líneas, palabra y caracteres de un archivo.
Para acceder al archivo, primero lo mapea en memoria, para así poder acceder a su contenido sin tener que leerlo usando <a href="https://man7.org/linux/man-pages/man2/read.2.html">read()</a>.
Una vez ha terminado, libera la memoria mapeada.</p>
</div>
<div class="paragraph">
<p>El ejemplo en <a href="https://github.com/ull-esit-sistemas-operativos/ssoo-ejemplos/blob/master/src/cap17/mapped-files.cpp">mapped-files.cpp</a> es identico al de <a href="https://github.com/ull-esit-sistemas-operativos/ssoo-ejemplos/blob/master/src/cap17/mapped-files.c">mapped-files.c</a>, pero desarrollado en C&#43;&#43;.
Usa la clase definida en <a href="https://github.com/ull-esit-sistemas-operativos/ssoo-ejemplos/blob/master/src/cap17/memory_map.hpp">memory_map.hpp</a> para abstraer la gestión del mapeo del archivo, por lo que en la implementación de sus métodos, obviamente, se utilizan las mismas llamadas al sistema que en <a href="https://github.com/ull-esit-sistemas-operativos/ssoo-ejemplos/blob/master/src/cap17/mapped-files.c">mapped-files.c</a>.
Este ejemplo es algo más complejo porque también muestra como manejar el puntero a la memoria mapeada de forma que sea liberada automáticamente cuando ya no es necesaria, siguiendo las pautas recomendadas en C&#43;&#43;.</p>
</div>
<div class="paragraph">
<p>Con Windows API el proceso requiere un paso más. Primero hay que usar el manejador del archivo abierto para crear un <strong>objeto de mapeo de archivo</strong> con <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createfilemappinga">CreateFileMapping()</a>.
Después, el manejador devuelto por <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-createfilemappinga">CreateFileMapping()</a> es usado con <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-mapviewoffile">MapViewOfFile()</a> para mapear el archivo en la memoria del proceso.</p>
</div>
<div class="paragraph">
<p>Para liberar la memoria mapeada, se utiliza <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-unmapviewoffile">UnmapViewOfFile()</a>.
Mientras que para cerrar el manejador del <strong>objeto de mapeo de archivo</strong> se usa <a href="https://docs.microsoft.com/en-us/windows/win32/api/handleapi/nf-handleapi-closehandle">CloseHandle()</a>, como es habitual.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mapeo_de_archivos_en_el_núcleo"><a class="anchor" href="#_mapeo_de_archivos_en_el_núcleo"></a>17.3.2. Mapeo de archivos en el núcleo</h4>
<div class="paragraph">
<p>Algunos sistemas operativos ofrecen el servicio de mapeo de archivos en la memoria solo a través de una llamada al sistema concreta, permitiendo utilizar las llamadas estándar —<a href="https://man7.org/linux/man-pages/man2/read.2.html">read()</a>, <a href="https://man7.org/linux/man-pages/man2/write.2.html">write()</a>, etc.— para hacer uso de la E/S tradicional.
Sin embargo, muchos sistemas modernos utilizan el mapeo en la memoria independientemente de que se pidan o no.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, en los sistemas POSIX, si un proceso utiliza llamada al sistema <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a> es porque explícitamente pide que el archivo sea mapeado en memoria.
Por tanto, el núcleo mapea el archivo en el espacio de direcciones del proceso.</p>
</div>
<div class="paragraph">
<p>Pero en Linux, Microsoft Windows y otros sistemas operativos modernos, adicionalmente, cuando un archivo es abierto con la llamada al sistema estándar —como <strong>open</strong>— el archivo es mapeado en el espacio de direcciones del núcleo y las llamadas <strong>read</strong> y <strong>write</strong> son traducidas en accesos a la memoria en dicha región.
No importa como sea abierto el archivo.
Estos sistemas tratan toda la E/S a archivos como mapeada en memoria, permitiendo que el acceso a los mismos, tenga lugar a través del eficiente componente de gestión de la memoria.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reemplazo_de_página"><a class="anchor" href="#_reemplazo_de_página"></a>17.4. Reemplazo de página</h3>
<div class="paragraph">
<p>Hasta el momento hemos considerado que disponemos de memoria física suficiente para atender cualquier fallo de página, pero ¿qué ocurre cuando no quedan marcos libres?.
En ese caso el código que da servicio a la excepción de <strong>fallo de página</strong> debe escoger alguna página, intercambiarla con el disco y utilizar el marco de la misma para cargar la nueva página.
Es decir, debemos modificar la función que ejecuta los pasos descritos en el <a href="memoria_virtual.html#_paginación_bajo_demanda">Apartado 17.1</a> de la siguiente manera:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Si la página es legal, debe ser cargada desde el disco.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Buscar la localización de la página en disco.</p>
</li>
<li>
<p>El núcleo debe buscar un marco de memoria libre que, por ejemplo, se puede escoger de la lista de marcos libres del sistema.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Si hay uno, usarlo.</p>
</li>
<li>
<p>Si no hay, usar un <strong>algoritmo de reemplazo de página</strong> para seleccionar una víctima.</p>
</li>
<li>
<p>Escribir la víctima en el disco y cambiar las <strong>tablas de páginas y de marcos libres</strong> de acuerdo a la nueva situación.
Para evitar mantener la CPU ocupada, el sistema debe solicitar la escritura de la página y poner al proceso en estado de <strong>esperando</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Se solicita una operación de disco para leer la página deseada en el marco asignado.
Para evitar mantener la CPU ocupada, el sistema debe solicitar la escritura de la página y poner al proceso en estado de <strong>esperando</strong>.</p>
</li>
<li>
<p>Cuando la lectura del disco haya terminado, se debe modificar la tabla interna de páginas válidas, y la tabla de páginas para indicar que la página está en la memoria.</p>
</li>
<li>
<p>Reiniciar la instrucción que fue interrumpida por la excepción.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Es importante destacar que en caso de <strong>reemplazo</strong> se necesita realizar dos accesos al disco.
Esto se puede evitar utilizando un <strong>bit de modificado</strong> asociado a cada entrada en la <strong>tabla de páginas</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Este bit es puesto a 1 por el hardware cuando se escribe en la página.</p>
</li>
<li>
<p>Se puede evitar escribir en disco aquellas páginas que tienen este bit a 0 cuando son seleccionadas para reemplazo, siempre que el contenido de la página no haya sido sobrescrito por otra en el espacio de intercambio.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En general, para implementar la paginación bajo demanda necesitamos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un <strong>algoritmo de asignación de marcos</strong>, que se encarga de asignar los marcos a los procesos.</p>
</li>
<li>
<p>Un <strong>algoritmo de reemplazo de página</strong> para seleccionar qué página reemplazamos cuando no hay marcos suficientes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obviamente, estos algoritmos deben ser escogidos de forma que mantengan la <strong>tasa de fallos de página</strong> lo más baja posible para perjudicar en lo mínimo el rendimiento del sistema.</p>
</div>
<div class="sect3">
<h4 id="_algoritmos_de_reemplazo_de_páginas"><a class="anchor" href="#_algoritmos_de_reemplazo_de_páginas"></a>17.4.1. Algoritmos de reemplazo de páginas</h4>
<div class="paragraph">
<p>
Hay muchos <strong>algoritmos de reemplazo de página</strong>.
La cuestión es cómo seleccionar uno en particular, sabiendo que debe tener la menor tasa posible de <strong>fallos de página</strong>.</p>
</div>
<div class="sect4">
<h5 id="_trazas_de_referencias"><a class="anchor" href="#_trazas_de_referencias"></a>Trazas de referencias</h5>
<div class="paragraph">
<p>
Podemos evaluar el algoritmo utilizando una secuencia de referencias a memoria y calculando el número de <strong>fallos de página</strong>.
A dicha secuencia de referencias se la denomina <strong>trazas de referencias</strong>.</p>
</div>
<div class="paragraph">
<p>Las trazas pueden ser obtenidas aleatoriamente u obteniéndolas a partir de las que hace un proceso en un sistema real.
Indudablemente, esta última alternativa puede proporcionar miles de millones de referencias.
Para reducir el número de datos podemos hacer dos cosas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>De cada referencia solo necesitamos considerar el número de página.</p>
</li>
<li>
<p>Si tenemos una referencia a la página <em>p</em>, cualquier referencia inmediatamente posterior a dicha página <em>p</em> nunca provocará un fallo de página, por lo que podemos ignorarlas.
Esto no tendría por qué ser cierto y si consideramos que hay varios procesos en el sistema y unos pueden expropiar a los otros.
Pero por simplicidad, ese no es nuestro caso.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo, si obtenemos la siguiente traza de un proceso particular:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0100, 0432, 0101, 0612, 0102, 0103, 0104, 0101, 0611, 0102, 0103, 0104, 0101, 0610, 0102, 0103, 0104, 0101, 0609, 0102, 0105</pre>
</div>
</div>
<div class="paragraph">
<p>con páginas de 100 bytes, podemos reducirla a:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1, 4, 1, 6, 1, 6, 1, 6, 1, 6, 1</pre>
</div>
</div>
<div class="paragraph">
<p>Indudablemente, para determinar el número de <strong>fallos de página</strong> también debemos conocer el número de marcos disponibles para el proceso.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reemplazo_fifo"><a class="anchor" href="#_reemplazo_fifo"></a>Reemplazo FIFO</h5>
<div class="paragraph">
<p>

El <strong>algoritmo de reemplazo de páginas FIFO</strong> es el más sencillo.
Funciona de la siguiente manera:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se asocia a cada página el instante de tiempo en que fue cargada por última vez.</p>
</li>
<li>
<p>Cuando hay que hacer reemplazo se selecciona como víctima a la página más antigua.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Realmente no es estrictamente necesario almacenar el instante de tiempo en que una página fue cargada.
En su lugar, las páginas en memoria pueden ser almacenadas en una cola FIFO, puesto que así se conserva su orden de llegada en el tiempo, que es lo que nos interesa.
Esta misma cola FIFO es utilizada en algunos algoritmos que veremos posteriormente.</p>
</div>
<div class="paragraph">
<p>Vamos a ilustrar este algoritmo con un ejemplo, donde supondremos que tenemos 3 marcos de memoria física:</p>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">4</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">3</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
</tr>
<tr>
<th class="tableblock halign-right valign-top" colspan="20"><p class="tableblock">13 fallos de página</p></th>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Como se puede observar, las primeras 3 referencias generan <strong>fallos de página</strong> porque se supone que los marcos no están asignados a ninguna página.
A partir de ahí se utiliza el <strong>algoritmo de reemplazo FIFO</strong> para seleccionar una página cuyo marco es utilizado para cargar la página requerida por el proceso.</p>
</div>
<div class="paragraph">
<p>El <strong>algoritmo FIFO</strong> no siempre tiene un buen rendimiento:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Puesto que utiliza el orden en el tiempo, puede reemplazar tanto páginas que no están siendo utilizadas como páginas usadas frecuentemente.
Sin embargo, aunque esto pase, todo seguirá funcionando correctamente, aunque aumentará la tasa de <strong>fallos de página</strong> enlenteciendo el sistema.</p>
</li>
<li>
<p>No siempre que aumenta la cantidad de memoria disponible mejora el rendimiento.</p>
</li>
</ul>
</div>
<div id="fig-fallos-de-página-frente-a-marcos" class="imageblock">
<div class="content">
<img src="media/C17-memoria_virtual/fallos_de_página_frente_a_marcos.svg" alt="fallos de página frente a marcos">
</div>
<div class="title">Figura 17.3. Fallos de página frente a número de marcos.</div>
</div>
<div class="paragraph">
<p>Es de esperar que si el número de marcos disponibles aumenta, el número de <strong>fallos de página</strong> disminuya (véase la <a href="memoria_virtual.html#fig-fallos-de-página-frente-a-marcos">Figura 17.3</a>).
Sin embargo, con el <strong>algoritmo FIFO</strong> el número de <strong>fallos de página</strong> puede aumentar cuando el número de marcos disponibles se incrementa.
Es lo que se conoce como la <strong>anormalidad de Belady</strong>.</p>
</div>
<div id="fig-anormalidad-de-belady" class="imageblock">
<div class="content">
<img src="media/C17-memoria_virtual/anormalidad_de_belady.svg" alt="anormalidad de belady">
</div>
<div class="title">Figura 17.4. Fallos de página con el algoritmo de reemplazo FIFO.</div>
</div>
<div class="paragraph">
<p>Para ilustrarlo consideraremos la siguiente traza de referencias:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5</pre>
</div>
</div>
<div class="paragraph">
<p>La <a href="memoria_virtual.html#fig-anormalidad-de-belady">Figura 17.4</a> muestra la curva de <strong>fallos de página</strong> frente el número de marcos.
Como se puede apreciar, el número de <strong>fallos de página</strong> con cuatro marcos es superior al número de fallos con tres marcos, aunque era de esperar que el número de fallos de páginas decrementara al aumentar el número de marcos.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reemplazo_óptimo"><a class="anchor" href="#_reemplazo_óptimo"></a>Reemplazo óptimo</h5>
<div class="paragraph">
<p>

Como resultado del descubrimiento de la <strong>anormalidad de Belady</strong> se comenzó a buscar un algoritmo de reemplazo de página óptimo.
Es decir:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Que tuviera la <strong>tasa de fallo de página</strong> más baja posible.</p>
</li>
<li>
<p>Que nunca sufra de la <strong>anormalidad de Belady</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ese algoritmo existe y consiste en reemplazar la página que no va a ser utilizada en el mayor periodo de tiempo.</p>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">4</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">3</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
</tr>
<tr>
<th class="tableblock halign-right valign-top" colspan="20"><p class="tableblock">9 fallos de página</p></th>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Desafortunadamente, el <strong>algoritmo de reemplazo óptimo</strong> es difícil de implementar, puesto que necesita saber las páginas que serán referenciadas en el futuro.
Por lo que solo se usa en estudios comparativos, con el fin de saber cuánto se aproxima al óptimo un algoritmo de reemplazo determinado.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reemplazo_lru"><a class="anchor" href="#_reemplazo_lru"></a>Reemplazo LRU</h5>
<div class="paragraph">
<p>

El <strong>algoritmo de reemplazo de página LRU</strong> (<em>Least Recently Used</em>) es una aproximación del óptimo.
La hipótesis es que si una página no ha sido usada durante un gran periodo de tiempo, entonces probablemente tampoco será utilizada en el futuro; por lo que reemplazando la página que hace más tiempo que no se usa, nos estaríamos aproximando al algoritmo óptimo.
Vamos a ilustrarlo con un ejemplo:</p>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">4</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">3</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
</tr>
<tr>
<th class="tableblock halign-right valign-top" colspan="20"><p class="tableblock">11 fallos de página</p></th>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Este algoritmo se considera bastante eficiente cuando se aplica al reemplazo de páginas, por lo que es utilizado con frecuencia.</p>
</div>
<div class="paragraph">
<p>Un detalle significativo es que necesita asociar cada página con el momento en que fue utilizada por última vez.
Aunque se pueden utilizar interrupciones para implementarlo por software —monitorizando cada acceso a la memoria— esta solución es muy ineficiente, puesto que se necesitaría actualizar algunos datos en la memoria en cada referencia a una página.
Por ello el reemplazo LRU es inconcebible sin apoyo del hardware.</p>
</div>
<div class="paragraph">
<p>Son posibles dos implementaciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utilizando contadores:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>La CPU debe tener un reloj lógico o contador que se incrementa con cada referencia a la memoria.</p>
</li>
<li>
<p>A cada página se añade un campo de <strong>instante de uso</strong>, que se almacena en la entrada de la tabla de páginas correspondiente.</p>
</li>
<li>
<p>Cuando una página es referenciada, el valor del contador de la CPU se almacena en el campo de <strong>instante de uso</strong> de dicha página.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>Esta implementación requiere que se haga una escritura en la memoria con cada referencia.
Además de una búsqueda por toda la tabla de páginas para localizar la página LRU.</p>
</div>
</li>
<li>
<p>Utilizando una pila:</p>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Se utiliza una pila de números de página.</p>
</li>
<li>
<p>Si se referencia una página, se quita el número correspondiente de la mitad de la pila y se inserta arriba.
Debido a esto, lo mejor es implementarla como una lista doblemente enlazada.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p>La actualización de la pila —que debe realizarse en cada referencia— tiene mayor coste que en la implementación anterior, pues puede ser necesario cambiar hasta 6 punteros.
Sin embargo, no es necesario realizar ninguna búsqueda para seleccionar la víctima del reemplazo, puesto que esta se puede extraer directamente del final de la pila.</p>
</li>
<li>
<p>Es una estrategia ideal para ser implementada en software o microcódigo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El <strong>algoritmo reemplazo LRU</strong> pertenece a una clase denominada <strong>algoritmos de pila</strong>, que nunca se ven afectados por la <strong>anormalidad de Belady</strong>.
En estos algoritmos, las páginas en memoria en un instante dado para <em>N</em> marcos son un subconjunto de las que podría haber con <em>N</em> + 1 marcos.
Concretamente, en el <strong>algoritmo LRU</strong> las páginas en los marcos son las <em>N</em> páginas más referenciadas recientemente.
Si el número de marcos aumentase, estas <em>N</em> páginas seguirán estando en memoria, pues siguen siendo las referenciadas más recientemente.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reemplazo_lru_aproximado"><a class="anchor" href="#_reemplazo_lru_aproximado"></a>Reemplazo LRU aproximado</h5>
<div class="paragraph">
<p>Pocos sistemas tienen soporte para utilizar el <strong>algoritmo de reemplazo de página LRU</strong>.
Incluso en algunos casos no hay soporte de ningún tipo, por lo que no queda más remedio que utilizar el reemplazo FIFO.</p>
</div>
<div class="paragraph">
<p>Sin embargo, muchos proporcionan algo de ayuda en la forma de un <strong>bit de referencia</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cada entrada de la tabla de páginas tiene un <strong>bit de referencia</strong>.</p>
</li>
<li>
<p>El hardware pone a 1 el <strong>bit de referencia</strong> cada vez que se referencia a una página.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Con el <strong>bit de referencia</strong> no podemos saber con exactitud el instante, pero sí que una página ha sido referenciada recientemente.
Utilizándolo, podemos implementar diversas aproximaciones al algoritmo LRU.</p>
</div>
<div class="sect5">
<h6 id="_reemplazo_nru"><a class="anchor" href="#_reemplazo_nru"></a>Reemplazo NRU</h6>
<div class="paragraph">
<p>

En el <strong>algoritmo de reemplazo de página NRU</strong> se utiliza el <strong>bit de referencia</strong> de la siguiente manera:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>En intervalos regulares de tiempo, todos los <strong>bits de referencia</strong> son puestos a cero por el sistema operativo.</p>
</li>
<li>
<p>Según los procesos se van ejecutando, el <strong>bit de referencia</strong> asociado a cada página se pone a 1 por el hardware, al ser referenciadas.</p>
</li>
<li>
<p>Cuando haya que escoger una página para ser reemplazada, se intenta seleccionar una que no haya sido referenciada —es decir, con el bit de referencia a 0—.</p>
</li>
<li>
<p>En caso de que haya varias alternativas entre las que elegir se puede utilizar el <strong>algoritmo de reemplazo de página FIFO</strong> o escoger un aleatoriamente.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Vamos a ilustrarlo con un ejemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utilizaremos 3 marcos de página.</p>
</li>
<li>
<p>Indicaremos el valor del bit de referencia con un superíndice junto al número de página.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Nota"></i>
</td>
<td class="content">
<div class="paragraph">
<p>No debemos olvidar que en caso de que ocurra un fallo de página, después de la carga de la página se reinicia la instrucción que generó dicho fallo.
Por lo tanto, habrá un acceso que pondrá el <strong>bit de referencia a 1</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Marcaremos con una flecha el instante de tiempo en el que todos los bits de referencia se ponen a cero.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Nota"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En un sistema operativo real los bits son desplazados en intervalos fijos de tiempo.
Pero esto no tiene que coincidir con una cantidad fija de referencias en la traza, puesto que hemos eliminado las referencias consecutivas a una misma página.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>En caso de coincidencia, utilizaremos el <strong>reemplazo FIFO</strong> para seleccionar la víctima.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">7</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">4</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">3</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">7</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
</tr>
<tr>
<th class="tableblock halign-right valign-top" colspan="20"><p class="tableblock">11 fallos de página</p></th>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Se puede mejorar el algoritmo anterior considerando tanto el <strong>bit de referencia</strong> como el <strong>bit de modificado</strong>, para clasificar las páginas en distintas categorías y escoger una página en la mejor categoría.
Este es el tipo más común de <strong>algoritmo de reemplazo de página NRU</strong>, pero lo veremos en el <a href="memoria_virtual.html#_algoritmo_de_la_segunda_oportunidad_mejorado">Apartado 17.4.1.5.4</a> bajo el nombre de <strong>Algoritmo de la segunda oportunidad mejorado</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_con_bits_de_referencia_adicionales"><a class="anchor" href="#_con_bits_de_referencia_adicionales"></a>Con bits de referencia adicionales</h6>
<div class="paragraph">
<p>Podemos obtener información adicional sobre el orden en que se realizan las referencias, guardando los <strong>bits de referencia</strong> en intervalos periódicos de tiempo.
El <strong>reemplazo LRU aproximado con bits de referencia adicionales</strong>, o de <strong>envejecimiento</strong>, consiste en lo siguiente:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Aparte del <strong>bit de referencia</strong>, cada página tiene un conjunto de <strong>bits de referencia adicionales</strong> —por ejemplo, 8 bits— que se guardan en alguna tabla interna que mantiene el sistema operativo.</p>
</li>
<li>
<p>A intervalos regulares —por ejemplo, cada 100 ms— el sistema operativo desplaza los <strong>bits de referencia adicionales</strong> de cada página; insertando el <strong>bit de referencia</strong> de la página en el bit de orden más alto y descartando el bit de orden más bajo.</p>
</li>
<li>
<p>Cuando haya que escoger una página para ser reemplazada se escoge la que tenga el valor más pequeño en el conjunto de <strong>bits de referencia adicionales</strong>.
Esto es así, puesto que dicho conjunto contiene la historia de referencias de la página.
Por ejemplo, {1 1 0 0 0 1 0 0} es más reciente que {0 1 1 1 0 1 1 1}.</p>
</li>
<li>
<p>Se puede utilizar el <strong>algoritmo de reemplazo de página FIFO</strong> o escoger un aleatoriamente, si dos páginas tienen el mismo valor.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Vamos a ilustrarlo con un ejemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utilizaremos 3 marcos de página.</p>
</li>
<li>
<p>Utilizaremos 2 bits adicionales.</p>
</li>
<li>
<p>Indicaremos el valor del <strong>bit de referencia</strong> y de los <strong>bits adicionales</strong> con un superíndice junto al número de página.</p>
</li>
<li>
<p>Marcaremos con una flecha el instante de tiempo en el que los bits son desplazados por el sistema operativo.</p>
</li>
<li>
<p>En caso de coincidencia, utilizaremos el <strong>reemplazo FIFO</strong> para seleccionar la víctima.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">7</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">4</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">3</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">7</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0|11</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>0|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>0|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>0|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>0|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1|11</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0|01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>0|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>0|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>0|10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1|00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1|00</sup></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
</tr>
<tr>
<th class="tableblock halign-right valign-top" colspan="20"><p class="tableblock">10 fallos de página</p></th>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>El número de <strong>bits adicionales</strong> puede variar de una implementación a otra, pero en cualquier caso debe ser seleccionado para realizar la actualización lo más rápidamente posible, teniendo en cuenta las características del hardware.
En un caso extremo, el número de <strong>bits de referencia adicionales</strong> podría ser cero, dejando solo el <strong>bit de referencia</strong>.
A este algoritmo se lo conoce como el <strong>algoritmo de la segunda oportunidad</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_algoritmo_de_la_segunda_oportunidad"><a class="anchor" href="#_algoritmo_de_la_segunda_oportunidad"></a>Algoritmo de la segunda oportunidad</h6>
<div class="paragraph">
<p>




El <strong>algoritmo de reemplazo de la segunda oportunidad</strong> o del <strong>reloj</strong> es un <strong>algoritmo de reemplazo de página FIFO</strong>, pero donde una página es seleccionada considerando el <strong>bit de referencia</strong>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Cuando es necesario seleccionar una víctima para reemplazo se extrae una página de la cola FIFO.
Esta cola contiene todas las páginas con marcos asignados y en el orden en que fueron cargadas, como ocurre con el <strong>algoritmo FIFO de reemplazo</strong>.</p>
</li>
<li>
<p>Si el <strong>bit de referencia</strong> está a 0, se utiliza esta página para reemplazo.</p>
</li>
<li>
<p>Si el <strong>bit de referencia</strong> está a 1:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Se pone el <strong>bit de referencia</strong> a 0 y se vuelve a insertar la página en el final de la cola.</p>
</li>
<li>
<p>Se extrae la siguiente página del principio de la cola y se vuelve al punto 2.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>De este esquema podemos destacar algunos aspectos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Una página a la que se le da la segunda oportunidad, no será reemplazada hasta que no se le dé la segunda oportunidad a todas las demás; siempre que no sea referenciada antes y el <strong>bit de referencia</strong> se vuelva a poner a 1.</p>
</li>
<li>
<p>En el peor de los casos, cuando todas las páginas tienen sus bits a uno, degenera en un reemplazo FIFO.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vamos a ilustrarlo con un ejemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utilizaremos 3 marcos de página.</p>
</li>
<li>
<p>Indicaremos el valor del <strong>bit de referencia</strong> con un superíndice junto al número de página en el marco.</p>
</li>
<li>
<p>Indicaremos el principio de la cola con una flecha junto al número de página.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">4</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">3</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→2<sup>0</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">→</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→3<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>0</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→4<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
</tr>
<tr>
<th class="tableblock halign-right valign-top" colspan="20"><p class="tableblock">11 fallos de página</p></th>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_algoritmo_de_la_segunda_oportunidad_mejorado"><a class="anchor" href="#_algoritmo_de_la_segunda_oportunidad_mejorado"></a>Algoritmo de la segunda oportunidad mejorado</h6>
<div class="paragraph">
<p>Se puede mejorar el <strong>algoritmo de la segunda oportunidad</strong> considerando tanto el <strong>bit de referencia</strong> como el <strong>bit de modificado</strong>.
Algunos autores denominan a este algoritmo como <strong>algoritmo de la segunda oportunidad mejorado</strong>, mientras otro lo llaman <strong>NRU</strong>, ya que es una versión mejorada del algoritmo del <a href="memoria_virtual.html#_reemplazo_nru">Apartado 17.4.1.5.1</a>.</p>
</div>
<div class="paragraph">
<p>Con esos dos bits, el sistema operativo clasifica las páginas en una de las siguientes cuatro clases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>(0,0) ni recientemente usado ni modificado. Las páginas de esta clase son las mejores para ser reemplazadas.</p>
</li>
<li>
<p>(0,1) no usado recientemente pero modificado. No es una buena elección, puesto que hay que escribir primero la página al disco antes del reemplazo.</p>
</li>
<li>
<p>(1,0) recientemente usado pero no modificado.
Probablemente será usada de nuevo en un corto espacio de tiempo.</p>
</li>
<li>
<p>(1,1) usada y modificada.
Será utilizada pronto y la página tendría que ser escrita a disco para ser reemplazada.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Cuando el reemplazo de página es invocado:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se examina la clase a la que pertenece cada página y se reemplaza una página en la clase de menor importancia que no esté vacía.
Indudablemente, deberemos examinar la lista varias veces antes de encontrar la página que debe ser reemplazada.</p>
</li>
<li>
<p>A intervalos regulares los <strong>bits de referencia</strong> de todas las páginas son puestos a cero por el sistema operativo.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Nota"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En un sistema real, el sistema operativo escribe las páginas modificadas en el almacenamiento secundario cuando está desocupado y luego pone el <strong>bit de modificado</strong> a 0.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Vamos a ilustrarlo con un ejemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utilizaremos 3 marcos de página.</p>
</li>
<li>
<p>El que la referencia a la memoria sea para lectura <strong>R</strong> o escritura <strong>W</strong> vendrá indicado junto al número de página en la traza.</p>
</li>
<li>
<p>Marcaremos con una flecha el instante de tiempo en el que todos los bits de referencia se ponen a cero.</p>
</li>
<li>
<p>Indicaremos el valor del <strong>bit de referencia</strong> y del <strong>bit de modificado</strong> con un superíndice junto al número de página en el marco.</p>
</li>
<li>
<p>Indicaremos el principio de la cola con una flecha junto al número de página.
Sirve para mantener un orden en las páginas, de tal forma que si hay varios candidatos de la misma categoría, se escoja el primero encontrado.
Si, por ejemplo, la elección en caso de varios candidatos es aleatoria, no hace falta ese puntero.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-left valign-top"><p class="tableblock">↓</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">7r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1w</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0w</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">4w</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0w</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">3w</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">2w</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">7w</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">0r</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">1r</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→7<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→2<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→2<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→2<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>10</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">→</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→1<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→1<sup>00</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→1<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→1<sup>10</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→7<sup>11</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→1<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>01</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">→0<sup>11</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>11</sup></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
</tr>
<tr>
<th class="tableblock halign-right valign-top" colspan="20"><p class="tableblock">11 fallos de página</p></th>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_reemplazo_basado_en_contador"><a class="anchor" href="#_reemplazo_basado_en_contador"></a>Reemplazo basado en contador</h5>
<div class="paragraph">
<p>Otros algoritmos utilizan un contador del número de referencias que son realizadas a cada página.
En esos casos, la elección de la víctima se puede realizar utilizando dos esquemas: la que tiene el valor mayor o el menor.
Ninguno de los dos es muy común, ya que su implementación es costosa y no son una buena aproximación del óptimo.</p>
</div>
<div class="paragraph">
<p>Por lo general, la actualización del contador no la realiza la CPU, ya que leer la entrada de la página, incrementar el contador y volver a guardar la entrada, tiene un coste importante.
En su lugar:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>El contador de cada página se guarda en una tabla interna.</p>
</li>
<li>
<p>Periódicamente el sistema operativo examina el <strong>bit de referencia</strong> de cada página y si está a 1, incrementa el contador de la página correspondiente.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>El mayor problema es que permite hacer el seguimiento de la frecuencia con la que se usan las páginas, pero no tiene en cuenta el periodo durante el que se usan.
Por ejemplo, los procesos durante su inicialización pueden usar intensamente ciertas páginas y después no necesitarlas más.
Debido a que esas páginas han sido utilizadas intensamente, tiene un contador de referencias con un valor muy alto, por lo que son mantenidas en memoria aunque no vaya a ser utilizadas.</p>
</div>
<div class="paragraph">
<p>La solución es utilizar el <strong>algoritmo LRU aproximado con bits de referencia adicionales</strong> (véase <a href="memoria_virtual.html#_con_bits_de_referencia_adicionales">Apartado 17.4.1.5.2</a>) porque tiene un coste muy similar a este y prioriza las usadas más recientemente sobre las que fueron usadas con mucha frecuencia en el pasado.</p>
</div>
<div class="sect5">
<h6 id="_reemplazo_lfu"><a class="anchor" href="#_reemplazo_lfu"></a>Reemplazo LFU</h6>
<div class="paragraph">
<p>



En el <strong>algoritmo de reemplazo de página LFU</strong> (<em>Least Frequently Used</em>) o <strong>NFU</strong>  (<em>Not Frequently Used</em>) se escoge la página con el contador más bajo.
Esto es así, puesto que suponemos que las páginas menos referenciadas son las que no se están utilizando de forma más activa.</p>
</div>
<div class="paragraph">
<p>Vamos a ilustrarlo con un ejemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Indicaremos el valor de los contadores con un superíndice junto al número de página.</p>
</li>
<li>
<p>En caso de coincidencia, utilizaremos el reemplazo <strong>FIFO</strong> para seleccionar la víctima.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">4</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">3</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>0</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>4</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>4</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>4</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>4</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>4</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>4</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>5</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>5</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>5</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>5</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>4</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>4</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>5</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>5</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>5</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>6</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>6</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>6</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>6</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>7</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>7</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
</tr>
<tr>
<th class="tableblock halign-right valign-top" colspan="20"><p class="tableblock">12 fallos de página</p></th>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_reemplazo_mfu"><a class="anchor" href="#_reemplazo_mfu"></a>Reemplazo MFU</h6>
<div class="paragraph">
<p>En el <strong>algoritmo de reemplazo de página MFU</strong> (<em>Most Frequently Used</em>), se escoge la página con el contador más alto.
Se basa en el argumento de que la página con el contador más pequeño probablemente acaba de ser traída, por lo que aún no ha sido utilizada.</p>
</div>
<div class="paragraph">
<p>Vamos a ilustrarlo con un ejemplo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Indicaremos el valor de los contadores con un superíndice junto al número de página.</p>
</li>
<li>
<p>En caso de coincidencia, utilizaremos el reemplazo <strong>FIFO</strong> para seleccionar la víctima.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch small">
<colgroup>
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">4</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">3</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
<th class="tableblock halign-center valign-top">2</th>
<th class="tableblock halign-center valign-top">7</th>
<th class="tableblock halign-center valign-top">0</th>
<th class="tableblock halign-center valign-top">1</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>3</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7<sup>1</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>1</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0<sup>2</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1<sup>1</sup></p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
<th class="tableblock halign-center valign-top"></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">F</p></th>
</tr>
<tr>
<th class="tableblock halign-right valign-top" colspan="20"><p class="tableblock">13 fallos de página</p></th>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Por extraña que parezca esta política, suele ser más eficiente que el <strong>LRU</strong> cuando se utiliza en las aplicaciones de almacenamiento de datos, porque algunas las páginas se utilizan intensamente durante breves periodos de tiempo, pero están un tiempo sin utilizarse.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_algoritmos_de_buffering_de_páginas"><a class="anchor" href="#_algoritmos_de_buffering_de_páginas"></a>17.4.2. Algoritmos de buffering de páginas</h4>
<div class="paragraph">
<p>
Existen otros procedimientos que pueden ser utilizados, junto con alguno de los <strong>algoritmos de reemplazo</strong> comentados, con el objetivo de mejorar su eficiencia.
Estos procedimientos se agrupan dentro de lo que se denomina <strong>algoritmos de <em>buffering</em> de páginas</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se puede mantener una lista de marcos libres.
Cuando se produce un <strong>fallo de página</strong> se escoge un marco de la lista y se carga la página, al tiempo que se selecciona una página como víctima y se copia al disco.</p>
<div class="paragraph">
<p>Esto permite que el proceso se reinicie lo antes posible, sin esperar a que la página reemplazada sea escrita en el disco.
Posteriormente, cuando la escritura finalice, el marco es incluido en la lista de marcos libres.</p>
</div>
</li>
<li>
<p>Recordar qué página estuvo en cada marco antes de que este pasara a la lista de marcos libres, sería una mejora de lo anterior.
De esta forma las páginas podrían ser recuperadas directamente desde la lista, si fallara alguna antes de que su marco sea utilizado por otra página.</p>
<div class="paragraph">
<p>Esto permite reducir los efectos de que el <strong>algoritmo de reemplazo</strong> escoja una víctima equivocada.</p>
</div>
</li>
<li>
<p>Se puede mantener una lista de páginas modificadas y escribirlas cuando el dispositivo del espacio de intercambio no esté ocupado.</p>
<div class="paragraph">
<p>Este esquema aumenta la probabilidad de que una página no esté marcada como modificada —con el <strong>bit de modificado</strong>— cuando sea seleccionada por el algoritmo de reemplazo, evitando tener que hacer en ese momento la escritura en disco.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_reemplazo_local_frente_a_global"><a class="anchor" href="#_reemplazo_local_frente_a_global"></a>17.4.3. Reemplazo local frente a global</h4>
<div class="paragraph">
<p>Cuando un proceso necesita un marco, el algoritmo de reemplazo puede, tanto extraerlo de cualquier proceso, como ser obligado a considerar solo aquellas páginas que pertenecen al proceso que generó el fallo.
Eso permite clasificar los algoritmos de reemplazo en dos categorías:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En el <strong>reemplazo local</strong> solo se pueden escoger marcos de entre los asignados al proceso.
Por tanto:</p>
<div class="ulist">
<ul>
<li>
<p>El número de marcos asignados a un proceso no cambia porque ocurran <strong>fallos de página</strong>.</p>
</li>
<li>
<p>El mayor inconveniente es que un proceso no puede hacer disponible a otros procesos los marcos de memoria que menos utiliza.</p>
</li>
</ul>
</div>
</li>
<li>
<p>En el <strong>reemplazo global</strong> se pueden escoger marcos de entre todos los del sistema, independientemente de que estén asignados a otro proceso o no.
Por tanto:</p>
<div class="ulist">
<ul>
<li>
<p>El número de marcos asignados a un proceso puede aumentar si durante los <strong>fallos de página</strong> se seleccionan marcos de otros procesos.</p>
</li>
<li>
<p>El mayor inconveniente es que los procesos no pueden controlar su <strong>tasa de fallos de página</strong>, puesto que esta depende del comportamiento de los otros procesos, pudiendo afectar a su tiempo de ejecución de forma significativa.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Generalmente, el <strong>reemplazo global</strong> proporciona mayor rendimiento, por lo que es el método más utilizado.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_asignación_de_marcos_de_página"><a class="anchor" href="#_asignación_de_marcos_de_página"></a>17.5. Asignación de marcos de página</h3>
<div class="paragraph">
<p>
La cuestión que queda por resolver es cómo repartir los marcos de memoria física libre entre los diferentes procesos, con el fin de cubrir las necesidades de reemplazo de cada uno de ellos.
Posibles soluciones a esto serían: repartir la memoria por igual entre todos los procesos o hacerlo en proporción a la cantidad de memoria virtual que utilizan.</p>
</div>
<div class="paragraph">
<p>Sin embargo, intuitivamente parece interesante intentar estimar de alguna manera el <strong>mínimo número de marcos</strong> que realmente necesita cada proceso.
Así, si a cada proceso se le proporciona el número mínimo de marcos necesario, el sistema podría disponer de memoria libre para aumentar el número de procesos —aumentando el uso de la CPU— o para dedicarla a otras funciones —como es el caso de los búferes y las cachés de E/S—.</p>
</div>
<div class="paragraph">
<p>El <strong>mínimo número de marcos</strong> viene establecido por diversos factores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cuando ocurre un fallo de página, la instrucción que la ha provocado, debe ser reiniciada después de cargar la página en un marco libre.
Por lo tanto, un proceso debe disponer de suficientes marcos como para guardar todas las páginas a las que una única instrucción pueda acceder pues, de lo contrario, el proceso nunca podría ser reiniciado al fallar permanentemente en alguno de los accesos a memoria de la instrucción.
Obviamente, este límite viene establecido por la arquitectura de la máquina.</p>
</li>
<li>
<p>Todo proceso tiene una cierta cantidad de páginas que en cada instante son utilizadas frecuentemente.
Si el proceso no dispone de suficientes marcos como para alojar dichas páginas, generará fallos de página con demasiada frecuencia.
Esto afecta negativamente al rendimiento del sistema, por lo que es conveniente que el sistema asigne al número de marcos necesario para que eso no ocurra.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>En general, si se va reduciendo el número de marcos asignados a un proceso, mucho antes de haber alcanzado el mínimo establecido por la arquitectura, el proceso dejará de ser útil debido a la elevada <strong>tasa de fallos de página</strong>, que será mayor cuanto menos marcos tenga asignados.
Cuando eso ocurre se dice que el proceso está <strong>hiperpaginando</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hiperpaginación"><a class="anchor" href="#_hiperpaginación"></a>17.6. Hiperpaginación</h3>
<div class="paragraph">
<p>
Como hemos comentado, la <strong>hiperpaginación</strong> se produce cuando un proceso no dispone de suficientes marcos como para alojar todas las páginas que necesita con frecuencia, por lo que la <strong>tasa de fallos de página</strong> se vuelve muy elevada.</p>
</div>
<div class="paragraph">
<p>Se dice que un proceso sufre de <strong>hiperpaginación</strong> cuando gasta más tiempo paginando que ejecutándose.</p>
</div>
<div class="sect3">
<h4 id="_hiperpaginación_en_sistemas_multiprogramados"><a class="anchor" href="#_hiperpaginación_en_sistemas_multiprogramados"></a>17.6.1. Hiperpaginación en sistemas multiprogramados</h4>
<div class="paragraph">
<p>En los primeros <strong>sistemas multiprogramados</strong> (<strong>mainframes</strong>) que implementaron la paginación bajo demanda, era posible que se diera el siguiente caso:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>El sistema operativo monitorizaba el uso de la CPU.
Si el uso de la misma era bajo, se cargaban nuevos procesos desde la <strong>cola de entrada</strong> para aumentar el número de procesos ejecutándose al mismo tiempo —también llamado <strong>grado de multiprogramación</strong> en esos sistemas—.</p>
</li>
<li>
<p>Si un proceso necesitaba demasiada memoria, le podía quitar los marcos a otro, puesto que se utilizaba un <strong>algoritmo de reemplazo global</strong>.
Esto podía ocasionar que aumentara la <strong>tasa de fallos de página</strong> del proceso que perdía los marcos.</p>
</li>
<li>
<p>Al aumentar los <strong>fallos de página</strong> el uso de la CPU decrecía, por lo que el sistema operativo cargaba más procesos para aumentar el <strong>grado de multiprogramación</strong> y con ello el uso de la CPU.</p>
</li>
<li>
<p>Esto reducía la cantidad de memoria disponible para cada proceso, lo que aumentaba la <strong>tasa de fallos de páginas</strong>, que nuevamente reducía el uso de la CPU.</p>
</li>
<li>
<p>Este mecanismo iteraba hasta reducir considerablemente el rendimiento del sistema.</p>
</li>
</ol>
</div>
<div id="fig-hiperpaginación" class="imageblock">
<div class="content">
<img src="media/C17-memoria_virtual/hiperpaginación.svg" alt="hiperpaginación">
</div>
<div class="title">Figura 17.5. Hiperpaginación en sistemas multiprogramados.</div>
</div>
<div class="paragraph">
<p>El fenómeno comentado se ilustra en la <a href="memoria_virtual.html#fig-hiperpaginación">Figura 17.5</a>, donde se muestra el uso de la CPU frente al número de procesos cargados en el sistema.
Cuando esto último aumenta, el uso de la CPU aumenta hasta alcanzar un máximo.
Si el <strong>grado de multiprogramación</strong> supera dicho punto, el sistema comienza a <strong>hiperpaginar</strong>, por lo que el uso de la CPU disminuye bruscamente.</p>
</div>
<div class="paragraph">
<p>Una solución es introducir un <strong>planificador de medio plazo</strong> que detecte si el sistema está <strong>hiperpaginando</strong>, en cuyo caso suspende y saca algunos procesos de la memoria —reduciendo así el <strong>grado de multiprogramación</strong>— con el objeto de liberar memoria para el resto de procesos en ejecución.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hiperpaginación_en_sistemas_operativos_modernos"><a class="anchor" href="#_hiperpaginación_en_sistemas_operativos_modernos"></a>17.6.2. Hiperpaginación en sistemas operativos modernos</h4>
<div class="paragraph">
<p>Los <strong>sistemas de tiempo compartido</strong> posteriores y los <strong>sistemas operativos modernos</strong> no tienen ni <strong>planificador de largo plazo</strong> ni <strong>cola de entrada</strong>, por lo que no ocurre el efecto en cadena descrito en el caso de los sistemas multiprogramados.
Sin embargo, puede ocurrir la <strong>hiperpaginación</strong> si se ejecutan demasiados procesos simultáneamente, de forma que alguno de ellos no disponga de suficientes marcos para alojar todas las páginas que utiliza frecuentemente (véase el <a href="memoria_virtual.html#_modelo_del_conjunto_de_trabajo">Apartado 17.6.4</a>), aumentando así la <strong>tasa de fallos de páginas</strong>, hasta el punto en que el proceso pasa más tiempo paginando que ejecutándose.</p>
</div>
<div class="paragraph">
<p>Los sistemas operativos modernos suelen carecer de <strong>planificador de medio plazo</strong> por lo que, a diferencia de los <strong>sistemas multiprogramados</strong>, no suspenden completamente la ejecución de algunos procesos para reducir el consumo de memoria y evitar la <strong>hiperpaginación</strong>.
En su lugar, utilizan técnicas de memoria virtual para ajustar la cantidad de marcos asignados a cada proceso, intentando evitar la <strong>hiperpaginación</strong>, al tiempo que maximizan el número de procesos que se pueden ejecutar simultaneamente.</p>
</div>
<div class="paragraph">
<p>En cualquier caso, como veremos en el <a href="memoria_virtual.html#_modelo_del_conjunto_de_trabajo">Apartado 17.6.4</a>, habrá <strong>hiperpaginación</strong> si la cantidad mínima total de marcos que necesitan todos los procesos para evitar la <strong>hiperpaginación</strong> excede el número de marcos disponibles en el sistema.</p>
</div>
</div>
<div class="sect3">
<h4 id="_soluciones_a_la_hiperpaginación"><a class="anchor" href="#_soluciones_a_la_hiperpaginación"></a>17.6.3. Soluciones a la hiperpaginación</h4>
<div class="paragraph">
<p>Para el problema de la <strong>hiperpaginación</strong> existen diversas soluciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La principal solución es proporcionar a un proceso tantos marcos como le hagan falta.
Como ya hemos comentado en diversas ocasiones, para evitar la <strong>hiperpaginación</strong> es necesario asignar al proceso al menos un número mínimo de marcos, que a priori no es conocido, ya que depende de cómo se comporta el proceso en su uso de la memoria.
Una de las estrategias que pretenden estimar dicho número es el <strong>modelo de conjunto de trabajo</strong>, que veremos en la <a href="memoria_virtual.html#_modelo_del_conjunto_de_trabajo">Apartado 17.6.4</a>.</p>
</li>
<li>
<p>Utilizar un algoritmo <strong>de reemplazo local</strong> puede limitiar el problema, pues de esta manera un proceso que <strong>hiperpagina</strong> no puede quitar marcos a otro, quizás incrementando su <strong>tasa de fallos de página</strong> y causando que también <strong>hiperpagine</strong>.</p>
<div class="paragraph">
<p>Sin embargo, un algoritmo de <strong>reemplazo local</strong> no evita completamente que un proceso que <strong>hiperpagine</strong> afecte a otros.
El uso intensivo del <strong>dispositivo de intercambio</strong>, por parte del proceso <strong>hiperpagina</strong>, puede afectar al rendimiento del sistema al aumentar el <strong>tiempo de acceso efectivo</strong> al disco.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_modelo_del_conjunto_de_trabajo"><a class="anchor" href="#_modelo_del_conjunto_de_trabajo"></a>17.6.4. Modelo del conjunto de trabajo</h4>
<div class="paragraph">
<p>
Para entender el modelo de conjunto de trabajo es necesario comenzar definiendo el <strong>modelo de localidad</strong>.
El <strong>modelo de localidad</strong> establece que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Una <strong>localidad</strong> es un conjunto de páginas que se utilizan juntas.</p>
</li>
<li>
<p>Cuando un proceso se ejecuta, se va moviendo de una <strong>localidad</strong> a otra.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo, cuando se invoca una función se define una nueva <strong>localidad</strong>.
En esta <strong>localidad</strong> las referencias a la memoria se realizan: al código de la función, a las variables locales de la misma y a algunas variables globales del programa.</p>
</div>
<div class="paragraph">
<p>Supongamos que proporcionamos a un proceso suficientes marcos como para alojar toda su <strong>localidad</strong> en un momento dado.
Entonces, el proceso generará <strong>fallos de página</strong> hasta que todas las páginas de su <strong>localidad</strong> estén cargadas.
Después de eso no volverá a fallar hasta que no cambie a una nueva <strong>localidad</strong>.
Sin embargo, si damos al proceso menos marcos de los que necesita su <strong>localidad</strong>, este <strong>hiperpaginará</strong>.</p>
</div>
<div class="paragraph">
<p>El <strong>modelo de conjunto de trabajo</strong> es una estrategia que permite obtener una aproximación de la <strong>localidad</strong> del programa y consiste en lo siguiente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Definir el parámetro <em>&#916;</em> como el tamaño de la <strong>ventana del conjunto de trabajo</strong>.</p>
</li>
<li>
<p>En un instante dado, el conjunto de páginas presente en las <em>&#916;</em> últimas referencias a la memoria se consideran el <strong>conjunto de trabajo</strong>.</p>
</li>
<li>
<p>Por lo tanto, el <strong>conjunto de trabajo</strong> es una aproximación de <strong>localidad</strong> del programa.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por ejemplo, dada la siguiente lista de referencias a páginas en la memoria:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="media/C17-memoria_virtual/modelo_de_conjunto_de_trabajo.svg" alt="modelo de conjunto de trabajo">
</div>
</div>
<div class="paragraph">
<p>si <em>&#916;</em> = 10 referencias a la memoria, entonces el conjunto de trabajo en <em>t</em><sub>1</sub> es {1, 2, 5, 6, 7}.
Mientras que en <em>t</em><sub>2</sub> el conjunto de trabajo es {1, 2, 3, 4}.</p>
</div>
<div class="paragraph">
<p>Obviamente, la precisión del <strong>conjunto de trabajo</strong> como aproximación de la <strong>localidad</strong> del programa depende del parámetro <em>&#916;</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si <em>&#916;</em> es muy pequeña, el <strong>conjunto de trabajo</strong> no cubriría toda la <strong>localidad</strong>.</p>
</li>
<li>
<p>Si <em>&#916;</em> es muy grande, el <strong>conjunto de trabajo</strong> se superpondría a varias <strong>localidades</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_uso_del_conjunto_del_trabajo_para_evitar_la_hiperpaginación"><a class="anchor" href="#_uso_del_conjunto_del_trabajo_para_evitar_la_hiperpaginación"></a>17.6.5. Uso del conjunto del trabajo para evitar la hiperpaginación</h4>
<div class="paragraph">
<p>El uso del conjunto de trabajo es bastante sencillo:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Los diseñadores del sistema seleccionan <em>&#916;</em>.</p>
</li>
<li>
<p>El sistema operativo monitoriza el <strong>conjunto de trabajo</strong> de cada proceso y le asigna tantos marcos como páginas haya en el <strong>conjunto de trabajo</strong>.</p>
</li>
<li>
<p>Si sobran globalmente suficientes marcos:</p>
<div class="ulist">
<ul>
<li>
<p>En el caso de los <strong>sistemas multiprogramados</strong>, otro proceso puede ser cargado desde la <strong>cola de entrada</strong> o desde el <strong>dispositivo de intercambio</strong>, si había sido suspendido previamente por el <strong>planificador de medio plazo</strong>.</p>
</li>
<li>
<p>En sistemas más modernos la memoria libre puede destinarse a otros usos, como caché o búferes de E/S.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Si el <strong>tamaño del conjunto de trabajo</strong> total <em>WSS</em> crece y excede el número de marcos disponibles:</p>
<div class="ulist">
<ul>
<li>
<p>En los <strong>sistemas multiprogramados</strong> con <strong>planificador de medio plazo</strong>, el sistema podría seleccionar un proceso para ser suspendido.
Este volverá a ser cargado y reiniciado más tardel, cuando haya suficientes marcos libres.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Los sistemas operativos más modernos reparten los marcos disponibles entre todos los procesos.
Al ser la cantidad de marcos disponibles inferior al  <em>WSS</em>, es posible que algunos procesos <strong>hiperpaginen</strong>.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>En la descripción anterior, el <strong>tamaño del conjunto de trabajo</strong> <em>WSS</em> es la suma del <strong>tamaño de los conjuntos de trabajo</strong> <em>WSS<sub>i</sub></em> para cada proceso <em>i</em>:</p>
</div>
<div class="stemblock">
<div class="content">
\$WSS=sum WSS_i\$
</div>
</div>
<div class="paragraph">
<p>y representa la demanda total de marcos.
Por eso, si <em>WSS</em> es mayor que el número de marcos disponibles, habrá <strong>hiperpaginación</strong>.</p>
</div>
<div class="paragraph">
<p>El sencillo algoritmo anterior permite evitar la <strong>hiperpaginación</strong>.
Sin embargo, el reto está en cómo mover la <strong>ventana del conjunto de trabajo</strong> en cada referencia, con el fin de volver a calcular el <strong>conjunto de trabajo</strong>.</p>
</div>
<div class="paragraph">
<p>Una posible aproximación es utilizar un temporizador que periódicamente invoque a una función encargada de examinar el <strong>bit de referencia</strong> de las páginas en la ventana de referencias <em>&#916;</em>.
Es de suponer que las páginas con el <strong>bit de referencia</strong> a 1 forman parte de la <strong>localidad</strong> del programa y por tanto serán el <strong>conjunto de trabajo</strong> a lo largo del siguiente periodo.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_otras_consideraciones"><a class="anchor" href="#_otras_consideraciones"></a>17.7. Otras consideraciones</h3>
<div class="paragraph">
<p>Ya hemos comentado que las principales decisiones que deben ser tomadas en el diseño de un sistema con <strong>paginación bajo demanda</strong> son la elección del <strong>algoritmo de reemplazo</strong> y la de la <strong>asignación de marcos de página</strong>.
Sin embargo, hay otras consideraciones que deben ser tenidas en cuenta.</p>
</div>
<div class="sect3">
<h4 id="_prepaginado"><a class="anchor" href="#_prepaginado"></a>17.7.1. Prepaginado</h4>
<div class="paragraph">
<p>El <strong>prepaginado</strong> es una técnica que consiste en cargar múltiples páginas junto con la página demandada en cada <strong>fallo de página</strong>.</p>
</div>
<div class="paragraph">
<p>Esas otras páginas se escogen especulativamente bajo la hipótesis de que van a ser necesitadas por el proceso en un corto espacio de tiempo.
De manera que si la predicción es acertada, la <strong>tasa de fallos de página</strong> se reduce significativamente.
Esta técnica puede ser utiliza, por ejemplo, en las siguientes situaciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En la <strong>paginación bajo demanda pura</strong>, el sistema sabe de antemano que cuando se inicia un proceso siempre fallan las primeras páginas de código, por lo que son buenas candidatas para el <strong>prepaginado</strong>.</p>
</li>
<li>
<p>En el acceso secuencial a <strong>archivos mapeados en memoria</strong>.</p>
<div class="paragraph">
<p>El sistema puede determinar que el acceso va a ser de tipo secuencial, tanto mediante el uso de técnicas heurísticas como mediante las opciones indicadas por el proceso en la llamada al sistema con la que se abrió el archivo.</p>
</div>
<div class="paragraph">
<p>En cualquier caso, si el sistema determina que el acceso al archivo es secuencial, en cada <strong>fallo de página</strong> puede cargar tanto la página demanda como las siguientes, en previsión de que vayan a ser utilizadas por el proceso.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>En general, el único inconveniente del <strong>prepaginado</strong> es que debe ser ajustado para que el coste del mismo sea inferior al de servir los <strong>fallos de página</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sobrereserva"><a class="anchor" href="#_sobrereserva"></a>17.7.2. Sobrereserva</h4>
<div class="paragraph">
<p>

Como las páginas de memoria de los procesos no necesitan memoria física hasta que son referenciadas, los sistemas operativos con memoria virtual pueden aceptar solicitudes de reserva de memoria aunque no haya suficiente memoria física disponible.
Para que el sistema operativo pueda garantizar que siempre tiene dónde almacenar cualquier página de cualquier proceso, debe asegurarse de que la cantidad total de memoria reservada no exceda el espacio total disponible entre la memoria física y el <strong>espacio de intercambio</strong>.
Por lo general, si una petición de reserva de memoria excede el espacio total disponible, el sistema operativo la rechazará.</p>
</div>
<div class="paragraph">
<p>Si embargo, algunos sistemas operativos pueden aceptar solicitudes de reserva de memoria que excedan el espacio total disponible.
En estos casos, el sistema operativo acepta la solicitud, pero no garantiza que la memoria reservada pueda ser utilizada.
Es lo que se conoce como <strong>sobrereserva</strong> u <strong><strong>overcommit</strong></strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Nota"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Muchas distribuciones de Linux hacen <strong>sobrereserva</strong> por defecto, aunque este comportamiento se puede desactivar.
Desactivar la <strong>sobrereserva</strong> es especialmente recomendable en sistemas críticos, donde no se puede permitir que el sistema operativo termine los procesos de forma prematura si el sistema se quedan sin espacio para almacenar las páginas de memoria.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La <strong>sobrereserva</strong> es útil porque algunos programas reservan más memoria de la que realmente necesitan, por lo que no tiene sentido que se compruebe si hay suficiente espacio hasta que el proceso no utilice realmente la memoria reservada.
Sin embargo, tiene el riesgo de que si se reserva más memoria de la disponible y todos los procesos intentan utilizar buena parte de ella, el sistema se quede sin espacio para almacenar las páginas de memoria y tenga que terminar procesos de forma prematura para liberar espacio.</p>
</div>
<div class="paragraph">
<p>En los sistemas Linux, <strong>Out Of Memory Killer</strong> u <strong>OOM Killer</strong> es el nombre que recibe la tarea del núcleo encargada de terminar procesos cuando el sistema se queda sin memoria.
El <strong>OOM Killer</strong> selecciona los procesos a terminar en función de una serie de criterios, como el uso de la CPU, la cantidad de memoria que consumen o si el proceso es un servicio o un proceso de usuario.</p>
</div>
</div>
<div class="sect3">
<h4 id="_aplicaciones_en_modo_raw"><a class="anchor" href="#_aplicaciones_en_modo_raw"></a>17.7.3. Aplicaciones en modo RAW</h4>
<div class="paragraph">
<p>Algunas aplicaciones, cuando acceden sus datos a través de los mecanismos de memoria virtual del sistema operativo, ofrecen peor rendimiento del que conseguirían si este mecanismo no existiera.</p>
</div>
<div class="paragraph">
<p>El ejemplo típico, son los gestores de bases de datos, que conocen sus necesidades de memoria y disco mejor que cualquier sistema operativo de propósito general, por lo que salen beneficiadas si implementan sus propios algoritmos de gestión de la memoria y de <em>buffering</em> de E/S.</p>
</div>
<div class="paragraph">
<p>Por eso muchos sistemas operativos modernos permiten que los programas que lo soliciten puedan acceder a los discos en <strong>modo RAW</strong>.
En el <strong>modo RAW</strong> no hay sistema de archivos, ni paginación bajo demanda, ni bloqueo de archivos, ni prepaginación, ni muchos otros servicios del sistema operativo; por lo que dichas aplicaciones deben implementar sus propios algoritmos de almacenamiento y gestión de la memoria.</p>
</div>
<div class="paragraph">
<p>Sin embargo, hay que valorar muy bien las necesidades del programa antes de optar por este modo.
La mayor parte de las aplicaciones siempre funcionan mejor utilizando los servicios convencionales ofrecidos por el sistema operativo.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tamaño_de_las_páginas_2"><a class="anchor" href="#_tamaño_de_las_páginas_2"></a>17.7.4. Tamaño de las páginas</h4>
<div class="paragraph">
<p>Como ya comentamos al estudiar el método básico de paginación (véase el <a href="paginación.html">Capítulo 16</a>), una decisión de diseño importante es escoger el tamaño adecuado para las páginas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Con páginas grandes</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Se consiguen menos <strong>fallos de páginas</strong>.
Por ejemplo, en un caso extremo, un proceso de 100 KiB solo podría generar un <strong>fallo de página</strong> si cada página es de 100 KiB, pero puede generar 102400 fallos si cada página es de 1 byte.</p>
</li>
<li>
<p>Se consiguen tablas de páginas más pequeñas.</p>
</li>
<li>
<p>La E/S para acceder al contenido de cada página requiere menos tiempo.</p>
<div class="paragraph">
<p>En general el tiempo de transferencia es proporcional a la cantidad de información transferida, lo que debería beneficiar a los sistemas con páginas de pequeño tamaño.
Sin embargo, la latencia y el tiempo requerido para posicionar la cabeza lectora de los discos es muy superior al tiempo de transferencias de datos, por lo que es más eficiente tener menos transferencias de mayor tamaño —como cuando se usan páginas grandes— que más transferencias de menor tamaño —como cuando se usan páginas pequeñas—.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Con páginas pequeñas</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Se consigue tener menos <strong>fragmentación interna</strong> y, por tanto, un mejor aprovechamiento de la memoria.</p>
</li>
<li>
<p>Teóricamente, se obtiene una mejor resolución para asignar y transferir al disco solo la memoria que realmente necesitamos.
Esto a la larga debería redundar en menos memoria asignada y menos operaciones de E/S.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>En la actualidad, el tamaño de página más común es de 4 KiB en sistemas de 32 bits y 8 KiB en los de 64 bits, ya que son adecuados para la mayor parte de las aplicaciones.
Sin embargo, muchos sistemas modernos soportan el uso simultáneo de múltiples tamaños de página.
Esto permite que la mayor parte de las aplicaciones utilicen el tamaño estándar, mientras las que hacen un uso intensivo de la memoria —como es el caso de los gestores de bases de datos— puedan utilizar páginas de mayor tamaño.</p>
</div>
</div>
<div class="sect3">
<h4 id="_efecto_de_la_estructura_de_los_programas"><a class="anchor" href="#_efecto_de_la_estructura_de_los_programas"></a>17.7.5. Efecto de la estructura de los programas</h4>
<div class="paragraph">
<p>Los programas creados considerando la <strong>localidad de referencia</strong> pueden mejorar su rendimiento en los sistemas con <strong>paginación bajo demanda</strong>.</p>
</div>
<div class="paragraph">
<p>Vamos a ilustrarlo con el siguiente ejemplo de un programa que inicializa a 0 un <em>array</em> de 128 por 128 elementos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="cpp"><span class="kt">char</span> <span class="n">data</span><span class="p">[][]</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="mi">128</span><span class="p">][</span><span class="mi">128</span><span class="p">];</span>

<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Un <em>array</em> como el indicado es almacenado en filas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="cpp"><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">...,</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">127</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">...,</span> <span class="n">data</span><span class="p">[</span><span class="mi">127</span><span class="p">][</span><span class="mi">127</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De manera que si suponemos que el tamaño de cada página es de 128 bytes, en el mejor de los casos cada fila estará almacenada en una página.
Por lo tanto:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si el sistema le asigna 128 marcos o más, el proceso solo generará 128 fallos de página.</p>
</li>
<li>
<p>Si el sistema operativo le asigna un solo marco, el proceso tendrá 16&#x2009;384 fallos, aproximadamente.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sin embargo, el ejemplo sería diferente si el bucle interno del programa recorriera las columnas del <em>array</em> y no las filas:</p>
</div>
<div class="paragraph">
<p>Pues se podrían a 0 primero todos los bytes de una misma página antes de empezar con la siguiente.
Esto reduciría el número de <strong>fallos de página</strong> a 128, aunque el sistema operativo solo asigne un marco al proceso.</p>
</div>
<div class="paragraph">
<p>Por lo tanto se puede concluir que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La selección cuidadosa de las estructuras de datos y de programación pueden mejorar la <strong>localidad</strong>, reduciendo la <strong>tasa de fallos de páginas</strong> y el tamaño del <strong>conjunto de trabajo</strong>.
Por ejemplo, las estructuras de datos tipo pila tienen buena <strong>localidad</strong>, puesto que el acceso siempre se realiza en lo alto de las mismas.
Sin embargo, las tablas de dispersión, obviamente, están diseñadas para dispersar las referencias, lo que produce una mala <strong>localidad</strong>.</p>
</li>
<li>
<p>La elección del lenguaje de programación también puede tener efecto.
En los lenguajes como C y C&#43;&#43; se utilizan punteros con frecuencia, lo que aleatoriza el acceso a la memoria, empeorando la <strong>localidad de referencia</strong>.
Además, algunos estudios indican que los lenguajes orientados a objetos tienden a tener peor <strong>localidad de referencia</strong> que los que no lo son.</p>
</li>
<li>
<p>El compilador y el cargador también pueden tener un efecto importante:</p>
<div class="ulist">
<ul>
<li>
<p>Separando el código de los datos para permitir que las páginas de código puedan ser de solo lectura.
Esto es interesante porque las páginas no modificadas no tienen que ser escritas antes de ser reemplazadas.</p>
</li>
<li>
<p>El compilador puede colocar las funciones que se llaman entre sí en la misma página.</p>
</li>
<li>
<p>El cargador puede situar las funciones en la memoria de tal forma que en lo posible no crucen los bordes de las páginas.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_interbloqueo_de_es"><a class="anchor" href="#_interbloqueo_de_es"></a>17.7.6. Interbloqueo de E/S</h4>
<div class="paragraph">
<p>Supongamos que un proceso solicita una operación de E/S sobre el contenido de alguna de las páginas de su espacio de direcciones y que, antes de que la operación sea realizada, la página es reemplazada mientras el proceso está esperando.
En ese caso, la operación de E/S se podría acabar realizando sobre una página que pertenece a un proceso diferente.
Para evitarlo existen diversas soluciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se puede utilizar la memoria del núcleo como búfer en las operaciones de E/S.</p>
<div class="paragraph">
<p>En una escritura, esto obliga a la llamada al sistema a copiar los datos desde las páginas del proceso a la memoria del núcleo, antes de solicitar la operación de E/S.
Mientras que en las operaciones de lectura sería justo al contrario.</p>
</div>
</li>
<li>
<p>Cada página puede tener un <strong>bit de bloqueo</strong> que se utiliza para indicar qué páginas no pueden ser seleccionadas para reemplazo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Además los <strong>bits de bloqueo</strong> se pueden utilizar en otras muchas situaciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bloquear las páginas del núcleo para evitar que sean reemplazadas.</p>
</li>
<li>
<p>Bloquear las páginas que acaban de ser cargadas.</p>
<div class="paragraph">
<p>Esto evita que un <strong>fallo de página</strong> en un proceso de mayor prioridad pueda reclamar el marco antes de que el proceso para el que se cargó la página originalmente sea reiniciado, desperdiciando el trabajo de cargarla y provocando un nuevo <strong>fallo de página</strong>.</p>
</div>
<div class="paragraph">
<p>Para implementarlo, se puede poner el <strong>bit de bloqueo</strong> a 1 cuando la página se carga, volviéndolo después a poner a 0 cuando el proceso es planificado por primera vez, tras el <strong>fallo de página</strong> que provocó la carga de la página.</p>
</div>
</li>
<li>
<p>En los sistemas con <strong>tiempo real flexible</strong>, se suele permitir que las tareas de tiempo real informen de cuáles son las páginas más importantes, con el fin de que sean bloqueadas para evitar que puedan ser reemplazadas.</p>
<div class="paragraph">
<p>Para evitar riesgos, el sistema suele considerar estas solicitudes como «consejos de bloqueo».
De esta manera el sistema es libre de descartar dichos consejos si el conjunto de marcos libres llega a ser demasiado pequeño o si un proceso pide bloquear demasiadas páginas.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interfaz_de_gestión_de_la_memoria"><a class="anchor" href="#_interfaz_de_gestión_de_la_memoria"></a>17.8. Interfaz de gestión de la memoria</h3>
<div class="paragraph">
<p>Gracias a la abstracción de las técnicas de memoria virtual —como la paginación bajo demanda— desde el punto de vista de los procesos, en cualquier sistema moderno prácticamente solo hace falta una llamada al sistema para gestionar su espacio de direcciones virtual.</p>
</div>
<div class="paragraph">
<p>En los sistemas POSIX esta llamada es <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a> y en Windows API es <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc">VirtualAlloc()</a>, que se usan junto a sus opuestas <a href="https://man7.org/linux/man-pages/man2/munmap.2.html">munmap()</a> y <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualfree">VirtualFree()</a>, respectivamente.</p>
</div>
<div class="paragraph">
<p>Ambas funciones permiten:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reservar una porción del espacio de direcciones virtual del proceso.</p>
<div class="paragraph">
<p>La llamada solo hace la reserva de un rango de direcciones para que pueda ser utilizado por el proceso —es decir, que las páginas en ese rango sean válidas— siendo el componente de paginación bajo demanda, el responsable de asignar la memoria física que lo respalda, cuando el proceso acceda a esas direcciones.</p>
</div>
</li>
<li>
<p>Establecer permisos —lectura, escritura y ejecución— opciones de compartición entre procesos, bloqueo de páginas en la memoria física, páginas de gran tamaño y otras opciones, en la región de memoria virtual a reservar.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Nota"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Además, en los sistemas POSIX, <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a> se utiliza también para mapear archivos en regiones del espacio de direcciones virtual.
Mientras que en Windows API para esa función se utilizan llamadas diferentes, como hemos visto.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ambas funciones ofrecen una buena cantidad de funcionalidades, pero operan a muy bajo nivel.
Por eso en ambas la página es la unidad mínima en la gestión de la memoria.
Es decir, las regiones reservadas del espacio de direcciones virtual, siempre deben comenzar en un borde de página y su tamaño debe ser múltiplo del tamaño de página.</p>
</div>
<div class="paragraph">
<p>El problema es cómo compatibilizar eso, con las necesidades reales de los programas, que durante su ejecución necesitan reservar y liberar constantemente memoria para pequeños elementos, como: <em>arrays</em>, cadenas de texto, estructuras u  objetos.
Para esos casos, utilizar directamente <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a> o <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc">VirtualAlloc()</a> no es una solución, puesto que la fragmentación interna conlleva un importante derroche de recursos.</p>
</div>
<div class="sect3">
<h4 id="_anatomía_del_espacio_de_direcciones_virtual_del_proceso"><a class="anchor" href="#_anatomía_del_espacio_de_direcciones_virtual_del_proceso"></a>17.8.1. Anatomía del espacio de direcciones virtual del proceso</h4>
<div class="paragraph">
<p>Los procesos pueden utilizar diversas ubicaciones dentro de su espacio de direcciones virtual para almacenar los datos que necesitan para su ejecución (véase la <a href="memoria_virtual.html#fig-proceso-en-memoria-completo">Figura 17.6</a>):</p>
</div>
<div id="fig-proceso-en-memoria-completo" class="imageblock">
<div class="content">
<img src="media/C17-memoria_virtual/proceso_en_memoria_completo.svg" alt="proceso en memoria completo">
</div>
<div class="title">Figura 17.6. Anatomía de un proceso en memoria.</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Las variables y constantes globales se almacenan en el <strong>segmento de datos</strong>, que tiene tamaño fijo, ya que las dimensiones de estas variables se conocen de antemano en tiempo de compilación, al igual que ocurre con el código del programa.</p>
</li>
<li>
<p>Las variables locales y los argumentos de las funciones se almacenan en la <strong>pila</strong>, junto con las direcciones de retorno para volver de las funciones.</p>
<div class="paragraph">
<p>Esta es la ubicación ideal para ellos, puesto que al retornar de una función, la pila se restablece al estado previo al que tenía cuando se invocó dicha función, haciendo que las variables locales y argumentos desaparezcan automáticamente.</p>
</div>
</li>
<li>
<p>Las variables reservadas dinámicamente —por ejemplo, usando <a href="https://en.cppreference.com/w/c/memory/malloc">malloc()</a>/<a href="https://en.cppreference.com/w/c/memory/free">free()</a> en C o <a href="https://en.cppreference.com/w/cpp/language/new">new</a>/<a href="https://en.cppreference.com/w/cpp/language/delete">delete</a> en C&#43;&#43; o Java— se almacenan en el <strong>montón</strong>, que no es más una región contigua de memoria ubicada inmediatamente después del <strong>segmento de datos</strong> del proceso.</p>
</li>
<li>
<p>En la región entre el <strong>montón</strong> y la <strong>pila</strong> se ubican los <strong>archivos mapeados en memoria</strong>, las regiones de <strong>memoria compartida</strong>, las <strong>librerías de enlace dinámico</strong>, las <strong>pilas</strong> de cada hilo —en procesos multihilo— y, en general, la memoria reservada con funciones como <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a> y <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc">VirtualAlloc()</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cada lenguaje de programación, debe proporcionar —a través de su <strong>librería estándar</strong>— un mecanismo en espacio de usuario, adecuado para la gestión en tiempo de ejecución de la memoria del <strong>montón</strong> del proceso.
Para eso, cada lenguaje puede utilizar su propia implementación de dicho mecanismo o bien recurrir a la proporcionada por la <strong>librería del sistema</strong>.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, en los sistemas POSIX, la <strong>librería del sistema</strong> proporciona su propia implementación, accesible a través de las funciones <a href="https://en.cppreference.com/w/c/memory/malloc">malloc()</a> y <a href="https://en.cppreference.com/w/c/memory/free">free()</a>, que es utilizada directamente por los programas escritos en C.
Esta implementación hace uso de <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a>, pero ofrece mayor control sobre la cantidad de memoria que podemos reservar, como veremos en el <a href="memoria_virtual.html#_gestión_de_la_memoria_del_montón">Apartado 17.8.2</a>.</p>
</div>
<div class="paragraph">
<p>Otros lenguajes de programación tienen otras interfaces para gestionar la memoria, pero utilizan internamente las funciones <a href="https://en.cppreference.com/w/c/memory/malloc">malloc()</a> y <a href="https://en.cppreference.com/w/c/memory/free">free()</a> de la <strong>librería del sistema</strong>.
Sin embargo, este no es el caso ni de C&#43;&#43; ni de Java ni de algunos otros lenguajes.
En C&#43;&#43;, los operadores <a href="https://en.cppreference.com/w/cpp/language/new">new</a> y <a href="https://en.cppreference.com/w/cpp/language/delete">delete</a> utilizan sus propios algoritmos de gestión de la memoria del <strong>montón</strong>, más optimizados que <a href="https://en.cppreference.com/w/c/memory/malloc">malloc()</a> y <a href="https://en.cppreference.com/w/c/memory/free">free()</a> para la creación y destrucción de objetos de cualquier tamaño de manera eficiente.</p>
</div>
<div class="paragraph">
<p>En Windows API ocurre algo similar.
La <strong>librería del sistema</strong> proporciona su propia gestión de la memoria del <strong>montón</strong>, que es accesible para cualquier programa a través de las funciones <a href="https://docs.microsoft.com/en-us/windows/win32/api/heapapi/nf-heapapi-heapalloc">HeapAlloc()</a> y <a href="https://docs.microsoft.com/en-us/windows/win32/api/heapapi/nf-heapapi-heapfree">HeapFree()</a>, y que se implementa sobre <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc">VirtualAlloc()</a>.
La <strong>librería estándar</strong> de C utiliza, a su vez, esas funciones para implementar <a href="https://en.cppreference.com/w/c/memory/malloc">malloc()</a> y <a href="https://en.cppreference.com/w/c/memory/free">free()</a>.
Lo mismo ocurre en otros lenguajes, aunque no en todos, ya que algunos optan por implementar algoritmos más eficientes para sus casos de uso directamente sobre <a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc">VirtualAlloc()</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gestión_de_la_memoria_del_montón"><a class="anchor" href="#_gestión_de_la_memoria_del_montón"></a>17.8.2. Gestión de la memoria del montón</h4>
<div class="paragraph">
<p>Para ilustrar cómo se puede gestionar la memoria del <strong>montón</strong> utilizaremos como ejemplo el mecanismo empleado por la <strong>librería del sistema</strong> de los sistemas POSIX —accesible a través de las funciones <a href="https://en.cppreference.com/w/c/memory/malloc">malloc()</a> y <a href="https://en.cppreference.com/w/c/memory/free">free()</a>.
Sin embargo, es importante tener en cuenta que esta tarea se realiza de manera muy similar en las implementaciones de otros sistemas operativos y lenguajes de programación.</p>
</div>
<div class="paragraph">
<p>El funcionamiento básico de <a href="https://en.cppreference.com/w/c/memory/malloc">malloc()</a> sigue las siguientes reglas:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Cuando la memoria solicitada supera cierto umbral —128 KiB en sistemas GNU/Linux— es reservada directamente mediante la llamada al sistema <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a>.
Eso significa que las peticiones de gran tamaño realmente no consumen espacio del <strong>montón</strong>, si no que se reservan del hueco entre el <strong>montón</strong> y la <strong>pila</strong>.</p>
</li>
<li>
<p>Cuando un proceso hace una petición de memoria dinámica espera que el espacio ofrecido sea continuo en el espacio de direcciones virtual, por lo que la memoria del <strong>montón</strong> se gestiona usando un algoritmo de <strong>asignación contigua de memoria</strong> (véase <a href="memoria_principal.html#_asignación_contigua_de_memoria">Apartado 15.5</a>) y, puesto que las peticiones pueden ser de tamaño variable, se utiliza con un esquema de <strong>particionado dinámico</strong>.</p>
<div class="paragraph">
<p>Es decir, que para las peticiones que no entran en el caso anterior, se busca en la tabla de huecos libres y ocupados del <strong>montón</strong> uno lo suficientemente como grande para atender la petición.
Se asigna el espacio solicitado y el resto sigue marcado como hueco libre.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Nota"></i>
</td>
<td class="content">
<div class="paragraph">
<p>La estrategia más común de búsqueda es el <strong>mejor ajuste</strong>, utilizando algún tipo de estructura de datos que mantenga los huecos libres ordenados por tamaño, para encontrar el de tamaño adecuado rápidamente.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Si no hay suficiente memoria libre contigua como para atender la petición, se utiliza la llamada al sistema <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a>, para extender el tamaño del <strong>montón</strong> reservando una nueva región separada —a veces llamada <strong>arena</strong>— y comenzar a repartirla.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Nota"></i>
</td>
<td class="content">
<div class="paragraph">
<p>En aplicaciones pequeñas, algunas implementaciones intentan ampliar primero el espacio libre utilizando la llamada al sistema <a href="https://man7.org/linux/man-pages/man2/brk.2.html">brk()</a>, que sirve para extender el <strong>montón</strong> sobre la región adyacente no asignada del espacio de direcciones virtual del proceso.
Este es el caso de la implementación estándar de <a href="https://en.cppreference.com/w/c/memory/malloc">malloc()</a> en GNU/Linux.</p>
</div>
<div class="paragraph">
<p>La llamada al sistema <a href="https://man7.org/linux/man-pages/man2/brk.2.html">brk()</a> ha sido eliminada del estándar POSIX, pero algunos sistemas la mantienen por compatibilidad hacia atrás, dado que era la forma en la que tradicionalmente se ampliaba la memoria del <strong>montón</strong> en los primeros UNIX.
En macOS esta llamada se emula con una región de 4 MiB reservada con <strong>mmap</strong> la primera vez que se utiliza.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La función <a href="https://en.cppreference.com/w/c/memory/calloc">calloc()</a> permite obtener memoria del <strong>montón</strong> inicializada a 0, por lo que sigue las mismas reglas que <a href="https://en.cppreference.com/w/c/memory/malloc">malloc()</a>.
Cuando la petición es pequeña, obtiene la memoria del <strong>montón</strong> —extendiéndolo si fuera necesario— para luego ponerla manualmente a 0 antes de retornar de la función.
Si la cantidad es grande —mayor de 128 KiB en sistemas GNU/Linux, como hemos comentado— obtiene la memoria llamando directamente a <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a>, que ya la devuelve inicializada a 0 y que usa técnicas como el <strong><em>copy-on-write</em></strong> para ahorrar memoria física, retrasando la asignación de marcos hasta el momento en el que el proceso comienza a escribir realmente en la memoria reservada.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fragmentación_2"><a class="anchor" href="#_fragmentación_2"></a>17.8.3. Fragmentación</h4>
<div class="paragraph">
<p>La estrategia comentada sufre de <strong>fragmentación interna</strong>.
En las peticiones grandes, <a href="https://man7.org/linux/man-pages/man2/mmap.2.html">mmap()</a> reserva en múltiplos de tamaño de página, por lo que siempre se puede perder cierta cantidad, aunque pequeña en comparación al tamaño de la región reservada.
En las peticiones pequeñas, la memoria se asigna en múltiplos de una unidad mínima —por ejemplo, 16 o 32 bytes— por lo que también se puede perder cierta cantidad de memoria.</p>
</div>
<div class="paragraph">
<p>Además sufre de <strong>fragmentación externa</strong>, porque después de que el proceso lleva un tiempo en ejecución, liberando y reservando memoria, el espacio puede comenzar a quedar fraccionado en un gran número de pequeños huecos, obligando a la librería a buscar más espacio para el <strong>montón</strong>, aunque en suma haya suficiente espacio en los huecos libres.</p>
</div>
<div class="paragraph">
<p>Esto representa un reto para los desarrolladores de aplicaciones, que previsiblemente vayan a ejecutarse durante periodos muy largos de tiempo.
En esos casos, es común optar por librerías externas, que implementen gestores de memoria que fragmenten menos la memoria, o soluciones basadas en alguna forma de referencias indirectas y recolección de basura, para ocasionalmente poder compactar la memoria del <strong>montón</strong>.
Esto último, es lo que hace la máquina virtual de Java.</p>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Anterior: <a href="paginación.html">Paginación</a> | ↑ Subir: <a href="gestión_de_la_memoria.html">Gestión de la memoria</a> | ⌂ Inicio: <a href="main.html">Sistemas Operativos</a> | Siguiente: <a href="gestión_del_almacenamiento.html">Gestión del almacenamiento</a> →</p>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "AMS" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<div id="footer">
    <div id="footer-text">
        Esta obra está sujeta a la licencia
        <a href="http://creativecommons.org/licenses/by/4.0/deed.es">Creative Commons Atribución 4.0 Internacional</a>,
        excepto donde se indique lo contrario.
    </div>
</div>
</body>
</html>